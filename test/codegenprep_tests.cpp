#include "testutils.h"
#include "gmock/gmock.h"
#include "gtest/gtest.h"
#include <filesystem>
#include <iostream>
#include <string>

extern "C"
{
#include "test_interface.h"
#include "to_string.h"
}

class CodeGenPrepTest : public testing::Test
{
  public:
    char *root_string = nullptr;
    char *symbols_string = nullptr;
    node_st *root = nullptr;
    std::string input_filepath;
    std::string err_output;
    std::string std_output;

  protected:
    CodeGenPrepTest()
    {
    }

    void SetUpNoExecute(std::string filepath)
    {
        input_filepath =
            std::filesystem::absolute(std::string(PROJECT_DIRECTORY) + "/test/data/" + filepath);
        ASSERT_TRUE(std::filesystem::exists(input_filepath))
            << "File does not exist at path '" << input_filepath << "'";
    }

    void SetUp(std::string filepath)
    {
        SetUpNoExecute(filepath);
        testing::internal::CaptureStdout();
        testing::internal::CaptureStderr();
        root = run_code_gen_preparation(input_filepath.c_str());
        EXPECT_NE(nullptr, root) << "Could not parse ast in file: '" << input_filepath << "'";
        err_output = testing::internal::GetCapturedStderr();
        std_output = testing::internal::GetCapturedStdout();
        ASSERT_THAT(err_output,
                    testing::Not(testing::HasSubstr("error: Inconsistent node found in AST")));
        root_string = node_to_string(root);
        symbols_string = symbols_to_string(root);
    }

    void TearDown() override
    {
        if (root_string != nullptr)
        {

            if (HasFailure())
            {
                std::cerr
                    << "========================================================================\n"
                    << "                        Node Representation\n"
                    << "========================================================================\n"
                    << root_string << std::endl;
            }

            free(root_string);
        }

        if (symbols_string != nullptr)
        {
            if (HasFailure())
            {
                std::cerr
                    << "========================================================================\n"
                    << "                        Symbol Tables of AST\n"
                    << "========================================================================\n"
                    << symbols_string << std::endl;
            }

            free(symbols_string);
        }

        if (root != nullptr)
        {
            cleanup_nodes(root);
            root = nullptr;
        }
    }
};

TEST_F(CodeGenPrepTest, GlobalArrayAssignments)
{
    SetUp("milestone_6/array_init/main.cvc");
    ASSERT_NE(nullptr, root);

    const char *expected = "Program\n"
                           "┢─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'int'\n"
                           "┃        ├─ ArrayExpr\n"
                           "┃        │  ┢─ Exprs\n"
                           "┃        │  ┃  └─ Int -- val:'5'\n"
                           "┃        │  ┡─ NULL\n"
                           "┃        │  └─ Var -- name:'@0_arr1'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'int'\n"
                           "┃        ├─ ArrayExpr\n"
                           "┃        │  ┢─ Exprs\n"
                           "┃        │  ┃  └─ Int -- val:'2'\n"
                           "┃        │  ┣─ Exprs\n"
                           "┃        │  ┃  └─ Int -- val:'3'\n"
                           "┃        │  ┡─ NULL\n"
                           "┃        │  └─ Var -- name:'@0_arr2'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'int'\n"
                           "┃        ├─ ArrayExpr\n"
                           "┃        │  ┢─ Exprs\n"
                           "┃        │  ┃  └─ Int -- val:'2'\n"
                           "┃        │  ┣─ Exprs\n"
                           "┃        │  ┃  └─ Int -- val:'3'\n"
                           "┃        │  ┣─ Exprs\n"
                           "┃        │  ┃  └─ Int -- val:'4'\n"
                           "┃        │  ┡─ NULL\n"
                           "┃        │  └─ Var -- name:'@0_arr3'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'int'\n"
                           "┃        ├─ Var -- name:'@0_a'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'1'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'__init'\n"
                           "┃     │  └─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ┢─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims0'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims1'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims2'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┡─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        ┢─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims0'\n"
                           "┃        ┃     └─ Int -- val:'5'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@0_arr1'\n"
                           "┃        ┃     └─ ProcCall\n"
                           "┃        ┃        ├─ Var -- name:'@alloc'\n"
                           "┃        ┃        ┢─ Exprs\n"
                           "┃        ┃        ┃  └─ Var -- name:'@loop_dims0'\n"
                           "┃        ┃        ┗─ NULL\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims1'\n"
                           "┃        ┃     └─ Binop -- op:'*'\n"
                           "┃        ┃        ├─ Int -- val:'2'\n"
                           "┃        ┃        └─ Int -- val:'3'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@0_arr2'\n"
                           "┃        ┃     └─ ProcCall\n"
                           "┃        ┃        ├─ Var -- name:'@alloc'\n"
                           "┃        ┃        ┢─ Exprs\n"
                           "┃        ┃        ┃  └─ Var -- name:'@loop_dims1'\n"
                           "┃        ┃        ┗─ NULL\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims2'\n"
                           "┃        ┃     └─ Binop -- op:'*'\n"
                           "┃        ┃        ├─ Binop -- op:'*'\n"
                           "┃        ┃        │  ├─ Int -- val:'2'\n"
                           "┃        ┃        │  └─ Int -- val:'3'\n"
                           "┃        ┃        └─ Int -- val:'4'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ ProcCall\n"
                           "┃        ┃        ├─ Var -- name:'@alloc'\n"
                           "┃        ┃        ┢─ Exprs\n"
                           "┃        ┃        ┃  └─ Var -- name:'@loop_dims2'\n"
                           "┃        ┃        ┗─ NULL\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Int -- val:'0'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr1'\n"
                           "┃        ┃     └─ Int -- val:'1'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Int -- val:'1'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr1'\n"
                           "┃        ┃     └─ Int -- val:'2'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr1'\n"
                           "┃        ┃     └─ Int -- val:'3'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr1'\n"
                           "┃        ┃     └─ Int -- val:'4'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Int -- val:'4'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr1'\n"
                           "┃        ┃     └─ Int -- val:'5'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Int -- val:'0'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'0'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr2'\n"
                           "┃        ┃     └─ Int -- val:'1'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Int -- val:'0'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'1'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr2'\n"
                           "┃        ┃     └─ Int -- val:'2'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Int -- val:'0'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr2'\n"
                           "┃        ┃     └─ Int -- val:'3'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Int -- val:'1'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'0'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr2'\n"
                           "┃        ┃     └─ Int -- val:'4'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Int -- val:'1'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'1'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr2'\n"
                           "┃        ┃     └─ Int -- val:'5'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Int -- val:'1'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr2'\n"
                           "┃        ┃     └─ Int -- val:'6'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  │  │  ├─ Int -- val:'0'\n"
                           "┃        ┃     │  ┃     │  │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  │  └─ Int -- val:'0'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'0'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ Int -- val:'1'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  │  │  ├─ Int -- val:'0'\n"
                           "┃        ┃     │  ┃     │  │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  │  └─ Int -- val:'0'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'1'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ Int -- val:'2'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  │  │  ├─ Int -- val:'0'\n"
                           "┃        ┃     │  ┃     │  │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  │  └─ Int -- val:'0'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ Int -- val:'3'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  │  │  ├─ Int -- val:'0'\n"
                           "┃        ┃     │  ┃     │  │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  │  └─ Int -- val:'0'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ Int -- val:'4'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  │  │  ├─ Int -- val:'0'\n"
                           "┃        ┃     │  ┃     │  │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  │  └─ Int -- val:'1'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'0'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ Int -- val:'5'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  │  │  ├─ Int -- val:'0'\n"
                           "┃        ┃     │  ┃     │  │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  │  └─ Int -- val:'1'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'1'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ Int -- val:'6'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  │  │  ├─ Int -- val:'0'\n"
                           "┃        ┃     │  ┃     │  │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  │  └─ Int -- val:'1'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ Int -- val:'7'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  │  │  ├─ Int -- val:'0'\n"
                           "┃        ┃     │  ┃     │  │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  │  └─ Int -- val:'1'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ Int -- val:'8'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  │  │  ├─ Int -- val:'0'\n"
                           "┃        ┃     │  ┃     │  │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'0'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ Int -- val:'9'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  │  │  ├─ Int -- val:'0'\n"
                           "┃        ┃     │  ┃     │  │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'1'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ Int -- val:'10'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  │  │  ├─ Int -- val:'0'\n"
                           "┃        ┃     │  ┃     │  │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ Int -- val:'11'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  │  │  ├─ Int -- val:'0'\n"
                           "┃        ┃     │  ┃     │  │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ Int -- val:'12'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  │  │  ├─ Int -- val:'1'\n"
                           "┃        ┃     │  ┃     │  │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  │  └─ Int -- val:'0'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'0'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ Int -- val:'13'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  │  │  ├─ Int -- val:'1'\n"
                           "┃        ┃     │  ┃     │  │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  │  └─ Int -- val:'0'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'1'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ Int -- val:'14'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  │  │  ├─ Int -- val:'1'\n"
                           "┃        ┃     │  ┃     │  │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  │  └─ Int -- val:'0'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ Int -- val:'15'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  │  │  ├─ Int -- val:'1'\n"
                           "┃        ┃     │  ┃     │  │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  │  └─ Int -- val:'0'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ Int -- val:'16'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  │  │  ├─ Int -- val:'1'\n"
                           "┃        ┃     │  ┃     │  │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  │  └─ Int -- val:'1'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'0'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ Int -- val:'17'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  │  │  ├─ Int -- val:'1'\n"
                           "┃        ┃     │  ┃     │  │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  │  └─ Int -- val:'1'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'1'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ Int -- val:'18'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  │  │  ├─ Int -- val:'1'\n"
                           "┃        ┃     │  ┃     │  │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  │  └─ Int -- val:'1'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ Int -- val:'19'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  │  │  ├─ Int -- val:'1'\n"
                           "┃        ┃     │  ┃     │  │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  │  └─ Int -- val:'1'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ Int -- val:'20'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  │  │  ├─ Int -- val:'1'\n"
                           "┃        ┃     │  ┃     │  │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'0'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ Int -- val:'21'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  │  │  ├─ Int -- val:'1'\n"
                           "┃        ┃     │  ┃     │  │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'1'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ Int -- val:'22'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  │  │  ├─ Int -- val:'1'\n"
                           "┃        ┃     │  ┃     │  │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ Int -- val:'23'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ArrayAssign\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
                           "┃        ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
                           "┃        ┃     │  ┃     │  │  │  ├─ Int -- val:'1'\n"
                           "┃        ┃     │  ┃     │  │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  │  └─ Int -- val:'2'\n"
                           "┃        ┃     │  ┃     │  └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┃     └─ Int -- val:'3'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@0_arr3'\n"
                           "┃        ┃     └─ Int -- val:'24'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@0_a'\n"
                           "┃        ┃     └─ Int -- val:'5'\n"
                           "┃        ┗─ NULL\n"
                           "┗─ NULL\n";

    ASSERT_MLSTREQ(expected, root_string);

    expected = "┌─ 0: Program\n"
               "├─ __init: FunHeader -- type:'void' -- Params: (null)\n"
               "├─ @0_arr1: VarDec -- type:'int'\n"
               "├─ @0_arr2: VarDec -- type:'int'\n"
               "├─ @0_arr3: VarDec -- type:'int'\n"
               "├─ @0_a: VarDec -- type:'int'\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '__init' -- parent: '0: Program'\n"
               "├─ @loop_dims0: VarDec -- type:'int'\n"
               "├─ @loop_dims1: VarDec -- type:'int'\n"
               "├─ @loop_dims2: VarDec -- type:'int'\n"
               "└────────────────────\n";

    ASSERT_MLSTREQ(expected, symbols_string);
}

TEST_F(CodeGenPrepTest, InitFun)
{
    SetUp("milestone_6/init_fun/main.cvc");
    ASSERT_NE(nullptr, root);

    const char *expected = "Program\n"
                           "┢─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'int'\n"
                           "┃        ├─ Var -- name:'@0_aa'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'int'\n"
                           "┃        ├─ Var -- name:'@0_ab'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'float'\n"
                           "┃        ├─ Var -- name:'@0_ba'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'float'\n"
                           "┃        ├─ Var -- name:'@0_bb'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'bool'\n"
                           "┃        ├─ Var -- name:'@0_ca'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'bool'\n"
                           "┃        ├─ Var -- name:'@0_cb'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'int'\n"
                           "┃        ├─ ArrayExpr\n"
                           "┃        │  ┢─ Exprs\n"
                           "┃        │  ┃  └─ Int -- val:'2'\n"
                           "┃        │  ┡─ NULL\n"
                           "┃        │  └─ Var -- name:'@0_da'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'int'\n"
                           "┃        ├─ ArrayExpr\n"
                           "┃        │  ┢─ Exprs\n"
                           "┃        │  ┃  └─ Int -- val:'3'\n"
                           "┃        │  ┡─ NULL\n"
                           "┃        │  └─ Var -- name:'@0_db'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'float'\n"
                           "┃        ├─ ArrayExpr\n"
                           "┃        │  ┢─ Exprs\n"
                           "┃        │  ┃  └─ Int -- val:'4'\n"
                           "┃        │  ┡─ NULL\n"
                           "┃        │  └─ Var -- name:'@0_ea'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'float'\n"
                           "┃        ├─ ArrayExpr\n"
                           "┃        │  ┢─ Exprs\n"
                           "┃        │  ┃  └─ Int -- val:'6'\n"
                           "┃        │  ┡─ NULL\n"
                           "┃        │  └─ Var -- name:'@0_eb'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'bool'\n"
                           "┃        ├─ ArrayExpr\n"
                           "┃        │  ┢─ Exprs\n"
                           "┃        │  ┃  └─ Int -- val:'7'\n"
                           "┃        │  ┡─ NULL\n"
                           "┃        │  └─ Var -- name:'@0_fa'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'bool'\n"
                           "┃        ├─ ArrayExpr\n"
                           "┃        │  ┢─ Exprs\n"
                           "┃        │  ┃  └─ Int -- val:'9'\n"
                           "┃        │  ┡─ NULL\n"
                           "┃        │  └─ Var -- name:'@0_fb'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'1'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'__init'\n"
                           "┃     │  └─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ┢─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims0'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_expr0'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_var0'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims1'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims2'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'float'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_expr2'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_var2'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims3'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims4'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'bool'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_expr4'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_var4'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims5'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┡─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        ┢─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims0'\n"
                           "┃        ┃     └─ Int -- val:'2'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@0_da'\n"
                           "┃        ┃     └─ ProcCall\n"
                           "┃        ┃        ├─ Var -- name:'@alloc'\n"
                           "┃        ┃        ┢─ Exprs\n"
                           "┃        ┃        ┃  └─ Var -- name:'@loop_dims0'\n"
                           "┃        ┃        ┗─ NULL\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@loop_expr0'\n"
                           "┃        ┃     └─ Int -- val:'4'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ForLoop\n"
                           "┃        ┃     ├─ Assign\n"
                           "┃        ┃     │  ├─ Var -- name:'@loop_var0'\n"
                           "┃        ┃     │  └─ Int -- val:'0'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims0'\n"
                           "┃        ┃     ├─ NULL\n"
                           "┃        ┃     ┢─ Statements\n"
                           "┃        ┃     ┃  └─ ArrayAssign\n"
                           "┃        ┃     ┃     ├─ ArrayExpr\n"
                           "┃        ┃     ┃     │  ┢─ Exprs\n"
                           "┃        ┃     ┃     │  ┃  └─ Var -- name:'@loop_var0'\n"
                           "┃        ┃     ┃     │  ┡─ NULL\n"
                           "┃        ┃     ┃     │  └─ Var -- name:'@0_da'\n"
                           "┃        ┃     ┃     └─ Var -- name:'@loop_expr0'\n"
                           "┃        ┃     ┗─ NULL\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims1'\n"
                           "┃        ┃     └─ Int -- val:'3'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@0_db'\n"
                           "┃        ┃     └─ ProcCall\n"
                           "┃        ┃        ├─ Var -- name:'@alloc'\n"
                           "┃        ┃        ┢─ Exprs\n"
                           "┃        ┃        ┃  └─ Var -- name:'@loop_dims1'\n"
                           "┃        ┃        ┗─ NULL\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims2'\n"
                           "┃        ┃     └─ Int -- val:'4'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@0_ea'\n"
                           "┃        ┃     └─ ProcCall\n"
                           "┃        ┃        ├─ Var -- name:'@alloc'\n"
                           "┃        ┃        ┢─ Exprs\n"
                           "┃        ┃        ┃  └─ Var -- name:'@loop_dims2'\n"
                           "┃        ┃        ┗─ NULL\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@loop_expr2'\n"
                           "┃        ┃     └─ Float -- val:'5.000000'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ForLoop\n"
                           "┃        ┃     ├─ Assign\n"
                           "┃        ┃     │  ├─ Var -- name:'@loop_var2'\n"
                           "┃        ┃     │  └─ Int -- val:'0'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims2'\n"
                           "┃        ┃     ├─ NULL\n"
                           "┃        ┃     ┢─ Statements\n"
                           "┃        ┃     ┃  └─ ArrayAssign\n"
                           "┃        ┃     ┃     ├─ ArrayExpr\n"
                           "┃        ┃     ┃     │  ┢─ Exprs\n"
                           "┃        ┃     ┃     │  ┃  └─ Var -- name:'@loop_var2'\n"
                           "┃        ┃     ┃     │  ┡─ NULL\n"
                           "┃        ┃     ┃     │  └─ Var -- name:'@0_ea'\n"
                           "┃        ┃     ┃     └─ Var -- name:'@loop_expr2'\n"
                           "┃        ┃     ┗─ NULL\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims3'\n"
                           "┃        ┃     └─ Int -- val:'6'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@0_eb'\n"
                           "┃        ┃     └─ ProcCall\n"
                           "┃        ┃        ├─ Var -- name:'@alloc'\n"
                           "┃        ┃        ┢─ Exprs\n"
                           "┃        ┃        ┃  └─ Var -- name:'@loop_dims3'\n"
                           "┃        ┃        ┗─ NULL\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims4'\n"
                           "┃        ┃     └─ Int -- val:'7'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@0_fa'\n"
                           "┃        ┃     └─ ProcCall\n"
                           "┃        ┃        ├─ Var -- name:'@alloc'\n"
                           "┃        ┃        ┢─ Exprs\n"
                           "┃        ┃        ┃  └─ Var -- name:'@loop_dims4'\n"
                           "┃        ┃        ┗─ NULL\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@loop_expr4'\n"
                           "┃        ┃     └─ Bool -- val:'1'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ForLoop\n"
                           "┃        ┃     ├─ Assign\n"
                           "┃        ┃     │  ├─ Var -- name:'@loop_var4'\n"
                           "┃        ┃     │  └─ Int -- val:'0'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims4'\n"
                           "┃        ┃     ├─ NULL\n"
                           "┃        ┃     ┢─ Statements\n"
                           "┃        ┃     ┃  └─ ArrayAssign\n"
                           "┃        ┃     ┃     ├─ ArrayExpr\n"
                           "┃        ┃     ┃     │  ┢─ Exprs\n"
                           "┃        ┃     ┃     │  ┃  └─ Var -- name:'@loop_var4'\n"
                           "┃        ┃     ┃     │  ┡─ NULL\n"
                           "┃        ┃     ┃     │  └─ Var -- name:'@0_fa'\n"
                           "┃        ┃     ┃     └─ Var -- name:'@loop_expr4'\n"
                           "┃        ┃     ┗─ NULL\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims5'\n"
                           "┃        ┃     └─ Int -- val:'9'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@0_fb'\n"
                           "┃        ┃     └─ ProcCall\n"
                           "┃        ┃        ├─ Var -- name:'@alloc'\n"
                           "┃        ┃        ┢─ Exprs\n"
                           "┃        ┃        ┃  └─ Var -- name:'@loop_dims5'\n"
                           "┃        ┃        ┗─ NULL\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@0_aa'\n"
                           "┃        ┃     └─ Int -- val:'2'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@0_ba'\n"
                           "┃        ┃     └─ Float -- val:'3.000000'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@0_ca'\n"
                           "┃        ┃     └─ Bool -- val:'1'\n"
                           "┃        ┗─ NULL\n"
                           "┗─ NULL\n";

    ASSERT_MLSTREQ(expected, root_string);

    expected = "┌─ 0: Program\n"
               "├─ __init: FunHeader -- type:'void' -- Params: (null)\n"
               "├─ @0_ea: VarDec -- type:'float'\n"
               "├─ @0_eb: VarDec -- type:'float'\n"
               "├─ @0_fa: VarDec -- type:'bool'\n"
               "├─ @0_fb: VarDec -- type:'bool'\n"
               "├─ @0_aa: VarDec -- type:'int'\n"
               "├─ @0_ab: VarDec -- type:'int'\n"
               "├─ @0_ba: VarDec -- type:'float'\n"
               "├─ @0_bb: VarDec -- type:'float'\n"
               "├─ @0_ca: VarDec -- type:'bool'\n"
               "├─ @0_cb: VarDec -- type:'bool'\n"
               "├─ @0_da: VarDec -- type:'int'\n"
               "├─ @0_db: VarDec -- type:'int'\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '__init' -- parent: '0: Program'\n"
               "├─ @loop_dims0: VarDec -- type:'int'\n"
               "├─ @loop_dims1: VarDec -- type:'int'\n"
               "├─ @loop_dims2: VarDec -- type:'int'\n"
               "├─ @loop_dims3: VarDec -- type:'int'\n"
               "├─ @loop_dims4: VarDec -- type:'int'\n"
               "├─ @loop_dims5: VarDec -- type:'int'\n"
               "├─ @loop_expr0: VarDec -- type:'int'\n"
               "├─ @loop_expr2: VarDec -- type:'float'\n"
               "├─ @loop_expr4: VarDec -- type:'bool'\n"
               "├─ @loop_var0: VarDec -- type:'int'\n"
               "├─ @loop_var2: VarDec -- type:'int'\n"
               "├─ @loop_var4: VarDec -- type:'int'\n"
               "└────────────────────\n";

    ASSERT_MLSTREQ(expected, symbols_string);
}

TEST_F(CodeGenPrepTest, ArrayFun)
{
    SetUp("milestone_6/array_fun/main.cvc");
    ASSERT_NE(nullptr, root);

    const char *expected = "Program\n"
                           "┢─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'int'\n"
                           "┃        ├─ Var -- name:'@0_k'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'0'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'@fun_fun'\n"
                           "┃     │  ┢─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_k'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ ArrayVar\n"
                           "┃     │  ┃     ┢─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_k'\n"
                           "┃     │  ┃     ┡─ NULL\n"
                           "┃     │  ┃     └─ Var -- name:'@1_arr'\n"
                           "┃     │  ┗─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ┢─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims0'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_expr0'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_var0'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Int -- val:'4'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@1_arr2'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@1_m'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@1_n'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@temp_0'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims1'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Var -- name:'@temp_0'\n"
                           "┃        ┃     │  ┣─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Var -- name:'@1_n'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@1_arr3'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┡─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        ┢─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims0'\n"
                           "┃        ┃     └─ Int -- val:'4'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@1_arr2'\n"
                           "┃        ┃     └─ ProcCall\n"
                           "┃        ┃        ├─ Var -- name:'@alloc'\n"
                           "┃        ┃        ┢─ Exprs\n"
                           "┃        ┃        ┃  └─ Var -- name:'@loop_dims0'\n"
                           "┃        ┃        ┗─ NULL\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@loop_expr0'\n"
                           "┃        ┃     └─ Int -- val:'2'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ForLoop\n"
                           "┃        ┃     ├─ Assign\n"
                           "┃        ┃     │  ├─ Var -- name:'@loop_var0'\n"
                           "┃        ┃     │  └─ Int -- val:'0'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims0'\n"
                           "┃        ┃     ├─ NULL\n"
                           "┃        ┃     ┢─ Statements\n"
                           "┃        ┃     ┃  └─ ArrayAssign\n"
                           "┃        ┃     ┃     ├─ ArrayExpr\n"
                           "┃        ┃     ┃     │  ┢─ Exprs\n"
                           "┃        ┃     ┃     │  ┃  └─ Var -- name:'@loop_var0'\n"
                           "┃        ┃     ┃     │  ┡─ NULL\n"
                           "┃        ┃     ┃     │  └─ Var -- name:'@1_arr2'\n"
                           "┃        ┃     ┃     └─ Var -- name:'@loop_expr0'\n"
                           "┃        ┃     ┗─ NULL\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@1_m'\n"
                           "┃        ┃     └─ ArrayExpr\n"
                           "┃        ┃        ┢─ Exprs\n"
                           "┃        ┃        ┃  └─ Int -- val:'1'\n"
                           "┃        ┃        ┡─ NULL\n"
                           "┃        ┃        └─ Var -- name:'@1_arr2'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@1_n'\n"
                           "┃        ┃     └─ Int -- val:'6'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@temp_0'\n"
                           "┃        ┃     └─ Binop -- op:'+'\n"
                           "┃        ┃        ├─ Var -- name:'@1_m'\n"
                           "┃        ┃        └─ Var -- name:'@1_n'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims1'\n"
                           "┃        ┃     └─ Binop -- op:'*'\n"
                           "┃        ┃        ├─ Var -- name:'@temp_0'\n"
                           "┃        ┃        └─ Var -- name:'@1_n'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@1_arr3'\n"
                           "┃        ┃     └─ ProcCall\n"
                           "┃        ┃        ├─ Var -- name:'@alloc'\n"
                           "┃        ┃        ┢─ Exprs\n"
                           "┃        ┃        ┃  └─ Var -- name:'@loop_dims1'\n"
                           "┃        ┃        ┗─ NULL\n"
                           "┃        ┗─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'0'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'@fun_fukk'\n"
                           "┃     │  ┢─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_k'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ ArrayVar\n"
                           "┃     │  ┃     ┢─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_k'\n"
                           "┃     │  ┃     ┡─ NULL\n"
                           "┃     │  ┃     └─ Var -- name:'@1_arr'\n"
                           "┃     │  ┗─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ┢─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@temp_0'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@temp_1'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims0'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Var -- name:'@temp_0'\n"
                           "┃        ┃     │  ┣─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Var -- name:'@temp_1'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@1_arr3'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┡─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        ┢─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@temp_0'\n"
                           "┃        ┃     └─ Binop -- op:'+'\n"
                           "┃        ┃        ├─ Int -- val:'3'\n"
                           "┃        ┃        └─ Int -- val:'3'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@temp_1'\n"
                           "┃        ┃     └─ Binop -- op:'+'\n"
                           "┃        ┃        ├─ Int -- val:'2'\n"
                           "┃        ┃        └─ Int -- val:'2'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims0'\n"
                           "┃        ┃     └─ Binop -- op:'*'\n"
                           "┃        ┃        ├─ Var -- name:'@temp_0'\n"
                           "┃        ┃        └─ Var -- name:'@temp_1'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@1_arr3'\n"
                           "┃        ┃     └─ ProcCall\n"
                           "┃        ┃        ├─ Var -- name:'@alloc'\n"
                           "┃        ┃        ┢─ Exprs\n"
                           "┃        ┃        ┃  └─ Var -- name:'@loop_dims0'\n"
                           "┃        ┃        ┗─ NULL\n"
                           "┃        ┗─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'1'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'__init'\n"
                           "┃     │  └─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ├─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        ┢─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@0_k'\n"
                           "┃        ┃     └─ Int -- val:'7'\n"
                           "┃        ┗─ NULL\n"
                           "┗─ NULL\n";

    ASSERT_MLSTREQ(expected, root_string);

    expected = "┌─ 0: Program\n"
               "├─ __init: FunHeader -- type:'void' -- Params: (null)\n"
               "├─ @fun_fukk: FunHeader -- type:'void' -- Params: int (Var -- name:'@1_k'), int "
               "(ArrayVar)\n"
               "├─ @0_k: VarDec -- type:'int'\n"
               "├─ @fun_fun: FunHeader -- type:'void' -- Params: int (Var -- name:'@1_k'), int "
               "(ArrayVar)\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '@fun_fun' -- parent: '0: Program'\n"
               "├─ @loop_dims0: VarDec -- type:'int'\n"
               "├─ @loop_dims1: VarDec -- type:'int'\n"
               "├─ @1_k: DimensionVars\n"
               "├─ @1_m: VarDec -- type:'int'\n"
               "├─ @1_n: VarDec -- type:'int'\n"
               "├─ @1_arr2: VarDec -- type:'int'\n"
               "├─ @1_arr3: VarDec -- type:'int'\n"
               "├─ @loop_expr0: VarDec -- type:'int'\n"
               "├─ @1_arr: Params -- type:'int'\n"
               "├─ @temp_0: VarDec -- type:'int'\n"
               "├─ @loop_var0: VarDec -- type:'int'\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '@fun_fukk' -- parent: '0: Program'\n"
               "├─ @loop_dims0: VarDec -- type:'int'\n"
               "├─ @1_k: DimensionVars\n"
               "├─ @1_arr3: VarDec -- type:'int'\n"
               "├─ @1_arr: Params -- type:'int'\n"
               "├─ @temp_0: VarDec -- type:'int'\n"
               "├─ @temp_1: VarDec -- type:'int'\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '__init' -- parent: '0: Program'\n"
               "└────────────────────\n";

    ASSERT_MLSTREQ(expected, symbols_string);
}

TEST_F(CodeGenPrepTest, ArrayParams)
{
    SetUp("milestone_8/arr_params/main.cvc");
    ASSERT_NE(nullptr, root);

    const char *expected = "Program\n"
                           "┢─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'0'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'@fun_fun'\n"
                           "┃     │  ┢─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_n'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_m'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ ArrayVar\n"
                           "┃     │  ┃     ┢─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_m'\n"
                           "┃     │  ┃     ┣─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_n'\n"
                           "┃     │  ┃     ┡─ NULL\n"
                           "┃     │  ┃     └─ Var -- name:'@1_arr'\n"
                           "┃     │  ┗─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ┢─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@1_a'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┡─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        ┢─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@1_a'\n"
                           "┃        ┃     └─ Binop -- op:'+'\n"
                           "┃        ┃        ├─ Int -- val:'1'\n"
                           "┃        ┃        └─ Int -- val:'2'\n"
                           "┃        ┗─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'1'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'__init'\n"
                           "┃     │  └─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ├─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        └─ NULL\n"
                           "┗─ NULL\n";

    ASSERT_MLSTREQ(expected, root_string);

    expected = "┌─ 0: Program\n"
               "├─ __init: FunHeader -- type:'void' -- Params: (null)\n"
               "├─ @fun_fun: FunHeader -- type:'void' -- Params: int (Var -- name:'@1_n'), int "
               "(Var -- name:'@1_m'), int (ArrayVar)\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '@fun_fun' -- parent: '0: Program'\n"
               "├─ @1_a: VarDec -- type:'int'\n"
               "├─ @1_m: DimensionVars\n"
               "├─ @1_n: DimensionVars\n"
               "├─ @1_arr: Params -- type:'int'\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '__init' -- parent: '0: Program'\n"
               "└────────────────────\n";

    ASSERT_MLSTREQ(expected, symbols_string);
}

TEST_F(CodeGenPrepTest, ShortCircuit)
{
    SetUp("milestone_9/main.cvc");
    ASSERT_NE(nullptr, root);

    const char *expected = "Program\n"
                           "┢─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'bool'\n"
                           "┃        ├─ Var -- name:'@0_a1'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'bool'\n"
                           "┃        ├─ Var -- name:'@0_a2'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'bool'\n"
                           "┃        ├─ Var -- name:'@0_a3'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'bool'\n"
                           "┃        ├─ Var -- name:'@0_a'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'0'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'@fun_test'\n"
                           "┃     │  └─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ┢─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'bool'\n"
                           "┃        ┃     ├─ Var -- name:'@1_b'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@1_c'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┡─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        ┢─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@1_b'\n"
                           "┃        ┃     └─ Bool -- val:'0'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@1_c'\n"
                           "┃        ┃     └─ Binop -- op:'+'\n"
                           "┃        ┃        ├─ Int -- val:'1'\n"
                           "┃        ┃        └─ Binop -- op:'*'\n"
                           "┃        ┃           ├─ Int -- val:'2'\n"
                           "┃        ┃           └─ Ternary\n"
                           "┃        ┃              ├─ Ternary\n"
                           "┃        ┃              │  ├─ Var -- name:'@0_a'\n"
                           "┃        ┃              │  ├─ Bool -- val:'1'\n"
                           "┃        ┃              │  └─ Binop -- op:'+'\n"
                           "┃        ┃              │     ├─ Var -- name:'@1_b'\n"
                           "┃        ┃              │     └─ Binop -- op:'*'\n"
                           "┃        ┃              │        ├─ Var -- name:'@1_b'\n"
                           "┃        ┃              │        └─ Var -- name:'@0_a'\n"
                           "┃        ┃              ├─ Int -- val:'1'\n"
                           "┃        ┃              └─ Int -- val:'0'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ IfStatement\n"
                           "┃        ┃     ├─ Ternary\n"
                           "┃        ┃     │  ├─ Var -- name:'@0_a'\n"
                           "┃        ┃     │  ├─ Ternary\n"
                           "┃        ┃     │  │  ├─ Var -- name:'@1_b'\n"
                           "┃        ┃     │  │  ├─ Bool -- val:'1'\n"
                           "┃        ┃     │  │  └─ Monop -- op:'!'\n"
                           "┃        ┃     │  │     └─ Var -- name:'@0_a'\n"
                           "┃        ┃     │  └─ Bool -- val:'0'\n"
                           "┃        ┃     ┢─ Statements\n"
                           "┃        ┃     ┃  └─ RetStatement\n"
                           "┃        ┃     ┃     └─ NULL\n"
                           "┃        ┃     ┡─ NULL\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ WhileLoop\n"
                           "┃        ┃     ├─ Ternary\n"
                           "┃        ┃     │  ├─ Ternary\n"
                           "┃        ┃     │  │  ├─ Ternary\n"
                           "┃        ┃     │  │  │  ├─ Ternary\n"
                           "┃        ┃     │  │  │  │  ├─ Ternary\n"
                           "┃        ┃     │  │  │  │  │  ├─ Ternary\n"
                           "┃        ┃     │  │  │  │  │  │  ├─ Var -- name:'@0_a'\n"
                           "┃        ┃     │  │  │  │  │  │  ├─ Var -- name:'@0_a'\n"
                           "┃        ┃     │  │  │  │  │  │  └─ Bool -- val:'0'\n"
                           "┃        ┃     │  │  │  │  │  ├─ Var -- name:'@0_a'\n"
                           "┃        ┃     │  │  │  │  │  └─ Bool -- val:'0'\n"
                           "┃        ┃     │  │  │  │  ├─ Var -- name:'@0_a'\n"
                           "┃        ┃     │  │  │  │  └─ Bool -- val:'0'\n"
                           "┃        ┃     │  │  │  ├─ Bool -- val:'1'\n"
                           "┃        ┃     │  │  │  └─ Var -- name:'@1_b'\n"
                           "┃        ┃     │  │  ├─ Bool -- val:'1'\n"
                           "┃        ┃     │  │  └─ Var -- name:'@1_b'\n"
                           "┃        ┃     │  ├─ Bool -- val:'1'\n"
                           "┃        ┃     │  └─ Ternary\n"
                           "┃        ┃     │     ├─ Var -- name:'@1_b'\n"
                           "┃        ┃     │     ├─ Var -- name:'@0_a'\n"
                           "┃        ┃     │     └─ Bool -- val:'0'\n"
                           "┃        ┃     ┢─ Statements\n"
                           "┃        ┃     ┃  └─ RetStatement\n"
                           "┃        ┃     ┃     └─ NULL\n"
                           "┃        ┃     ┗─ NULL\n"
                           "┃        ┗─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'1'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'__init'\n"
                           "┃     │  └─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ├─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        ┢─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@0_a1'\n"
                           "┃        ┃     └─ Bool -- val:'1'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@0_a2'\n"
                           "┃        ┃     └─ Bool -- val:'0'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@0_a3'\n"
                           "┃        ┃     └─ Bool -- val:'1'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@0_a'\n"
                           "┃        ┃     └─ Ternary\n"
                           "┃        ┃        ├─ Ternary\n"
                           "┃        ┃        │  ├─ Var -- name:'@0_a1'\n"
                           "┃        ┃        │  ├─ Var -- name:'@0_a2'\n"
                           "┃        ┃        │  └─ Bool -- val:'0'\n"
                           "┃        ┃        ├─ Var -- name:'@0_a3'\n"
                           "┃        ┃        └─ Bool -- val:'0'\n"
                           "┃        ┗─ NULL\n"
                           "┗─ NULL\n";

    ASSERT_MLSTREQ(expected, root_string);

    expected = "┌─ 0: Program\n"
               "├─ __init: FunHeader -- type:'void' -- Params: (null)\n"
               "├─ @0_a: VarDec -- type:'bool'\n"
               "├─ @fun_test: FunHeader -- type:'void' -- Params: (null)\n"
               "├─ @0_a1: VarDec -- type:'bool'\n"
               "├─ @0_a2: VarDec -- type:'bool'\n"
               "├─ @0_a3: VarDec -- type:'bool'\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '@fun_test' -- parent: '0: Program'\n"
               "├─ @1_b: VarDec -- type:'bool'\n"
               "├─ @1_c: VarDec -- type:'int'\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '__init' -- parent: '0: Program'\n"
               "└────────────────────\n";

    ASSERT_MLSTREQ(expected, symbols_string);
}

TEST_F(CodeGenPrepTest, BooleanCast)
{
    SetUp("milestone_10/main.cvc");
    ASSERT_NE(nullptr, root);

    const char *expected = "Program\n"
                           "┢─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'0'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'@fun_test'\n"
                           "┃     │  └─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ┢─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@1_a'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@1_b'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@1_c'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'float'\n"
                           "┃        ┃     ├─ Var -- name:'@1_d'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'float'\n"
                           "┃        ┃     ├─ Var -- name:'@1_e'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'float'\n"
                           "┃        ┃     ├─ Var -- name:'@1_f'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'bool'\n"
                           "┃        ┃     ├─ Var -- name:'@1_g'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'bool'\n"
                           "┃        ┃     ├─ Var -- name:'@1_h'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'bool'\n"
                           "┃        ┃     ├─ Var -- name:'@1_j'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┡─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        ┢─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@1_a'\n"
                           "┃        ┃     └─ Ternary\n"
                           "┃        ┃        ├─ Bool -- val:'0'\n"
                           "┃        ┃        ├─ Int -- val:'1'\n"
                           "┃        ┃        └─ Int -- val:'0'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@1_b'\n"
                           "┃        ┃     └─ Cast -- type:'int'\n"
                           "┃        ┃        └─ Float -- val:'0.000000'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@1_c'\n"
                           "┃        ┃     └─ Int -- val:'0'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@1_d'\n"
                           "┃        ┃     └─ Ternary\n"
                           "┃        ┃        ├─ Bool -- val:'1'\n"
                           "┃        ┃        ├─ Float -- val:'1.000000'\n"
                           "┃        ┃        └─ Float -- val:'0.000000'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@1_e'\n"
                           "┃        ┃     └─ Float -- val:'3.000000'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@1_f'\n"
                           "┃        ┃     └─ Cast -- type:'float'\n"
                           "┃        ┃        └─ Int -- val:'3'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@1_g'\n"
                           "┃        ┃     └─ Bool -- val:'0'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@1_h'\n"
                           "┃        ┃     └─ Ternary\n"
                           "┃        ┃        ├─ Binop -- op:'!='\n"
                           "┃        ┃        │  ├─ Float -- val:'10.000000'\n"
                           "┃        ┃        │  └─ Float -- val:'0.000000'\n"
                           "┃        ┃        ├─ Bool -- val:'1'\n"
                           "┃        ┃        └─ Bool -- val:'0'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@1_j'\n"
                           "┃        ┃     └─ Ternary\n"
                           "┃        ┃        ├─ Binop -- op:'!='\n"
                           "┃        ┃        │  ├─ Int -- val:'10'\n"
                           "┃        ┃        │  └─ Int -- val:'0'\n"
                           "┃        ┃        ├─ Bool -- val:'1'\n"
                           "┃        ┃        └─ Bool -- val:'0'\n"
                           "┃        ┗─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'1'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'__init'\n"
                           "┃     │  └─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ├─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        └─ NULL\n"
                           "┗─ NULL\n";

    ASSERT_MLSTREQ(expected, root_string);

    expected = "┌─ 0: Program\n"
               "├─ __init: FunHeader -- type:'void' -- Params: (null)\n"
               "├─ @fun_test: FunHeader -- type:'void' -- Params: (null)\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '@fun_test' -- parent: '0: Program'\n"
               "├─ @1_a: VarDec -- type:'int'\n"
               "├─ @1_b: VarDec -- type:'int'\n"
               "├─ @1_c: VarDec -- type:'int'\n"
               "├─ @1_d: VarDec -- type:'float'\n"
               "├─ @1_e: VarDec -- type:'float'\n"
               "├─ @1_f: VarDec -- type:'float'\n"
               "├─ @1_g: VarDec -- type:'bool'\n"
               "├─ @1_h: VarDec -- type:'bool'\n"
               "├─ @1_j: VarDec -- type:'bool'\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '__init' -- parent: '0: Program'\n"
               "└────────────────────\n";

    ASSERT_MLSTREQ(expected, symbols_string);
}

TEST_F(CodeGenPrepTest, ArrayProccall)
{
    SetUp("milestone_8/arr_proccall/main.cvc");
    ASSERT_NE(nullptr, root);

    const char *expected = "Program\n"
                           "┢─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'0'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'@fun_fun_one'\n"
                           "┃     │  ┢─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_b'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_a'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ ArrayVar\n"
                           "┃     │  ┃     ┢─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_a'\n"
                           "┃     │  ┃     ┣─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_b'\n"
                           "┃     │  ┃     ┡─ NULL\n"
                           "┃     │  ┃     └─ Var -- name:'@1_e'\n"
                           "┃     │  ┗─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ├─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        ┢─ Statements\n"
                           "┃        ┃  └─ ProcCall\n"
                           "┃        ┃     ├─ Var -- name:'@fun_fun_two'\n"
                           "┃        ┃     ┢─ Exprs\n"
                           "┃        ┃     ┃  └─ Var -- name:'@1_b'\n"
                           "┃        ┃     ┣─ Exprs\n"
                           "┃        ┃     ┃  └─ Var -- name:'@1_a'\n"
                           "┃        ┃     ┣─ Exprs\n"
                           "┃        ┃     ┃  └─ Var -- name:'@1_e'\n"
                           "┃        ┃     ┗─ NULL\n"
                           "┃        ┗─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'0'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'@fun_fun_two'\n"
                           "┃     │  ┢─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_d'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_c'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ ArrayVar\n"
                           "┃     │  ┃     ┢─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_c'\n"
                           "┃     │  ┃     ┣─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_d'\n"
                           "┃     │  ┃     ┡─ NULL\n"
                           "┃     │  ┃     └─ Var -- name:'@1_f'\n"
                           "┃     │  ┗─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ┢─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@1_g'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┡─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        ┢─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@1_g'\n"
                           "┃        ┃     └─ Int -- val:'2'\n"
                           "┃        ┗─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'1'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'__init'\n"
                           "┃     │  └─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ├─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        └─ NULL\n"
                           "┗─ NULL\n";

    ASSERT_MLSTREQ(expected, root_string);

    expected = "┌─ 0: Program\n"
               "├─ __init: FunHeader -- type:'void' -- Params: (null)\n"
               "├─ @fun_fun_one: FunHeader -- type:'void' -- Params: int (Var -- name:'@1_b'), int "
               "(Var -- name:'@1_a'), int (ArrayVar)\n"
               "├─ @fun_fun_two: FunHeader -- type:'void' -- Params: int (Var -- name:'@1_d'), int "
               "(Var -- name:'@1_c'), int (ArrayVar)\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '@fun_fun_one' -- parent: '0: Program'\n"
               "├─ @1_a: DimensionVars\n"
               "├─ @1_b: DimensionVars\n"
               "├─ @1_e: Params -- type:'int'\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '@fun_fun_two' -- parent: '0: Program'\n"
               "├─ @1_c: DimensionVars\n"
               "├─ @1_d: DimensionVars\n"
               "├─ @1_f: Params -- type:'int'\n"
               "├─ @1_g: VarDec -- type:'int'\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '__init' -- parent: '0: Program'\n"
               "└────────────────────\n";

    ASSERT_MLSTREQ(expected, symbols_string);
}

TEST_F(CodeGenPrepTest, DimensionReduction)
{
    SetUp("milestone_11/main.cvc");
    ASSERT_NE(nullptr, root);

    const char *expected =
        "Program\n"
        "┢─ Declarations\n"
        "┃  └─ GlobalDef -- has_export:'0'\n"
        "┃     └─ VarDec -- type:'int'\n"
        "┃        ├─ Var -- name:'@0_m'\n"
        "┃        └─ NULL\n"
        "┣─ Declarations\n"
        "┃  └─ GlobalDef -- has_export:'0'\n"
        "┃     └─ VarDec -- type:'int'\n"
        "┃        ├─ Var -- name:'@0_n'\n"
        "┃        └─ NULL\n"
        "┣─ Declarations\n"
        "┃  └─ GlobalDef -- has_export:'0'\n"
        "┃     └─ VarDec -- type:'int'\n"
        "┃        ├─ ArrayExpr\n"
        "┃        │  ┢─ Exprs\n"
        "┃        │  ┃  └─ Var -- name:'@0_m'\n"
        "┃        │  ┣─ Exprs\n"
        "┃        │  ┃  └─ Var -- name:'@0_n'\n"
        "┃        │  ┡─ NULL\n"
        "┃        │  └─ Var -- name:'@0_a'\n"
        "┃        └─ NULL\n"
        "┣─ Declarations\n"
        "┃  └─ GlobalDec -- type:'int'\n"
        "┃     └─ ArrayVar\n"
        "┃        ┢─ DimensionVars\n"
        "┃        ┃  └─ Var -- name:'@0_m1'\n"
        "┃        ┣─ DimensionVars\n"
        "┃        ┃  └─ Var -- name:'@0_n2'\n"
        "┃        ┡─ NULL\n"
        "┃        └─ Var -- name:'@0_b'\n"
        "┣─ Declarations\n"
        "┃  └─ FunDef -- has_export:'0'\n"
        "┃     ├─ FunHeader -- type:'void'\n"
        "┃     │  ├─ Var -- name:'@fun_test'\n"
        "┃     │  ┢─ Params -- type:'int'\n"
        "┃     │  ┃  └─ Var -- name:'@1_r'\n"
        "┃     │  ┣─ Params -- type:'int'\n"
        "┃     │  ┃  └─ Var -- name:'@1_n'\n"
        "┃     │  ┣─ Params -- type:'int'\n"
        "┃     │  ┃  └─ Var -- name:'@1_l'\n"
        "┃     │  ┣─ Params -- type:'int'\n"
        "┃     │  ┃  └─ Var -- name:'@1_k'\n"
        "┃     │  ┣─ Params -- type:'int'\n"
        "┃     │  ┃  └─ ArrayVar\n"
        "┃     │  ┃     ┢─ DimensionVars\n"
        "┃     │  ┃     ┃  └─ Var -- name:'@1_k'\n"
        "┃     │  ┃     ┣─ DimensionVars\n"
        "┃     │  ┃     ┃  └─ Var -- name:'@1_l'\n"
        "┃     │  ┃     ┣─ DimensionVars\n"
        "┃     │  ┃     ┃  └─ Var -- name:'@1_n'\n"
        "┃     │  ┃     ┣─ DimensionVars\n"
        "┃     │  ┃     ┃  └─ Var -- name:'@1_r'\n"
        "┃     │  ┃     ┡─ NULL\n"
        "┃     │  ┃     └─ Var -- name:'@1_c'\n"
        "┃     │  ┗─ NULL\n"
        "┃     └─ FunBody\n"
        "┃        ┢─ VarDecs\n"
        "┃        ┃  └─ VarDec -- type:'int'\n"
        "┃        ┃     ├─ Var -- name:'@loop_dims0'\n"
        "┃        ┃     └─ NULL\n"
        "┃        ┣─ VarDecs\n"
        "┃        ┃  └─ VarDec -- type:'int'\n"
        "┃        ┃     ├─ Var -- name:'@loop_expr0'\n"
        "┃        ┃     └─ NULL\n"
        "┃        ┣─ VarDecs\n"
        "┃        ┃  └─ VarDec -- type:'int'\n"
        "┃        ┃     ├─ Var -- name:'@loop_var0'\n"
        "┃        ┃     └─ NULL\n"
        "┃        ┣─ VarDecs\n"
        "┃        ┃  └─ VarDec -- type:'int'\n"
        "┃        ┃     ├─ ArrayExpr\n"
        "┃        ┃     │  ┢─ Exprs\n"
        "┃        ┃     │  ┃  └─ Var -- name:'@1_k'\n"
        "┃        ┃     │  ┣─ Exprs\n"
        "┃        ┃     │  ┃  └─ Var -- name:'@1_l'\n"
        "┃        ┃     │  ┣─ Exprs\n"
        "┃        ┃     │  ┃  └─ Var -- name:'@1_n'\n"
        "┃        ┃     │  ┣─ Exprs\n"
        "┃        ┃     │  ┃  └─ Var -- name:'@1_r'\n"
        "┃        ┃     │  ┡─ NULL\n"
        "┃        ┃     │  └─ Var -- name:'@1_d'\n"
        "┃        ┃     └─ NULL\n"
        "┃        ┣─ VarDecs\n"
        "┃        ┃  └─ VarDec -- type:'int'\n"
        "┃        ┃     ├─ Var -- name:'@for0_ik'\n"
        "┃        ┃     └─ NULL\n"
        "┃        ┣─ VarDecs\n"
        "┃        ┃  └─ VarDec -- type:'int'\n"
        "┃        ┃     ├─ Var -- name:'@for1_il'\n"
        "┃        ┃     └─ NULL\n"
        "┃        ┣─ VarDecs\n"
        "┃        ┃  └─ VarDec -- type:'int'\n"
        "┃        ┃     ├─ Var -- name:'@for2_in'\n"
        "┃        ┃     └─ NULL\n"
        "┃        ┣─ VarDecs\n"
        "┃        ┃  └─ VarDec -- type:'int'\n"
        "┃        ┃     ├─ Var -- name:'@for3_ir'\n"
        "┃        ┃     └─ NULL\n"
        "┃        ┣─ VarDecs\n"
        "┃        ┃  └─ VarDec -- type:'int'\n"
        "┃        ┃     ├─ Var -- name:'@temp_0'\n"
        "┃        ┃     └─ NULL\n"
        "┃        ┣─ VarDecs\n"
        "┃        ┃  └─ VarDec -- type:'int'\n"
        "┃        ┃     ├─ Var -- name:'@temp_1'\n"
        "┃        ┃     └─ NULL\n"
        "┃        ┣─ VarDecs\n"
        "┃        ┃  └─ VarDec -- type:'int'\n"
        "┃        ┃     ├─ Var -- name:'@temp_2'\n"
        "┃        ┃     └─ NULL\n"
        "┃        ┣─ VarDecs\n"
        "┃        ┃  └─ VarDec -- type:'int'\n"
        "┃        ┃     ├─ Var -- name:'@temp_3'\n"
        "┃        ┃     └─ NULL\n"
        "┃        ┡─ NULL\n"
        "┃        ├─ NULL\n"
        "┃        ┢─ Statements\n"
        "┃        ┃  └─ Assign\n"
        "┃        ┃     ├─ Var -- name:'@loop_dims0'\n"
        "┃        ┃     └─ Binop -- op:'*'\n"
        "┃        ┃        ├─ Binop -- op:'*'\n"
        "┃        ┃        │  ├─ Binop -- op:'*'\n"
        "┃        ┃        │  │  ├─ Var -- name:'@1_k'\n"
        "┃        ┃        │  │  └─ Var -- name:'@1_l'\n"
        "┃        ┃        │  └─ Var -- name:'@1_n'\n"
        "┃        ┃        └─ Var -- name:'@1_r'\n"
        "┃        ┣─ Statements\n"
        "┃        ┃  └─ Assign\n"
        "┃        ┃     ├─ Var -- name:'@1_d'\n"
        "┃        ┃     └─ ProcCall\n"
        "┃        ┃        ├─ Var -- name:'@alloc'\n"
        "┃        ┃        ┢─ Exprs\n"
        "┃        ┃        ┃  └─ Var -- name:'@loop_dims0'\n"
        "┃        ┃        ┗─ NULL\n"
        "┃        ┣─ Statements\n"
        "┃        ┃  └─ Assign\n"
        "┃        ┃     ├─ Var -- name:'@loop_expr0'\n"
        "┃        ┃     └─ Int -- val:'5'\n"
        "┃        ┣─ Statements\n"
        "┃        ┃  └─ ForLoop\n"
        "┃        ┃     ├─ Assign\n"
        "┃        ┃     │  ├─ Var -- name:'@loop_var0'\n"
        "┃        ┃     │  └─ Int -- val:'0'\n"
        "┃        ┃     ├─ Var -- name:'@loop_dims0'\n"
        "┃        ┃     ├─ NULL\n"
        "┃        ┃     ┢─ Statements\n"
        "┃        ┃     ┃  └─ ArrayAssign\n"
        "┃        ┃     ┃     ├─ ArrayExpr\n"
        "┃        ┃     ┃     │  ┢─ Exprs\n"
        "┃        ┃     ┃     │  ┃  └─ Var -- name:'@loop_var0'\n"
        "┃        ┃     ┃     │  ┡─ NULL\n"
        "┃        ┃     ┃     │  └─ Var -- name:'@1_d'\n"
        "┃        ┃     ┃     └─ Var -- name:'@loop_expr0'\n"
        "┃        ┃     ┗─ NULL\n"
        "┃        ┣─ Statements\n"
        "┃        ┃  └─ Assign\n"
        "┃        ┃     ├─ Var -- name:'@temp_0'\n"
        "┃        ┃     └─ Var -- name:'@1_k'\n"
        "┃        ┣─ Statements\n"
        "┃        ┃  └─ ForLoop\n"
        "┃        ┃     ├─ Assign\n"
        "┃        ┃     │  ├─ Var -- name:'@for0_ik'\n"
        "┃        ┃     │  └─ Int -- val:'0'\n"
        "┃        ┃     ├─ Var -- name:'@temp_0'\n"
        "┃        ┃     ├─ NULL\n"
        "┃        ┃     ┢─ Statements\n"
        "┃        ┃     ┃  └─ Assign\n"
        "┃        ┃     ┃     ├─ Var -- name:'@temp_1'\n"
        "┃        ┃     ┃     └─ Var -- name:'@1_l'\n"
        "┃        ┃     ┣─ Statements\n"
        "┃        ┃     ┃  └─ ForLoop\n"
        "┃        ┃     ┃     ├─ Assign\n"
        "┃        ┃     ┃     │  ├─ Var -- name:'@for1_il'\n"
        "┃        ┃     ┃     │  └─ Int -- val:'0'\n"
        "┃        ┃     ┃     ├─ Var -- name:'@temp_1'\n"
        "┃        ┃     ┃     ├─ NULL\n"
        "┃        ┃     ┃     ┢─ Statements\n"
        "┃        ┃     ┃     ┃  └─ Assign\n"
        "┃        ┃     ┃     ┃     ├─ Var -- name:'@temp_2'\n"
        "┃        ┃     ┃     ┃     └─ Var -- name:'@1_n'\n"
        "┃        ┃     ┃     ┣─ Statements\n"
        "┃        ┃     ┃     ┃  └─ ForLoop\n"
        "┃        ┃     ┃     ┃     ├─ Assign\n"
        "┃        ┃     ┃     ┃     │  ├─ Var -- name:'@for2_in'\n"
        "┃        ┃     ┃     ┃     │  └─ Int -- val:'0'\n"
        "┃        ┃     ┃     ┃     ├─ Var -- name:'@temp_2'\n"
        "┃        ┃     ┃     ┃     ├─ NULL\n"
        "┃        ┃     ┃     ┃     ┢─ Statements\n"
        "┃        ┃     ┃     ┃     ┃  └─ Assign\n"
        "┃        ┃     ┃     ┃     ┃     ├─ Var -- name:'@temp_3'\n"
        "┃        ┃     ┃     ┃     ┃     └─ Var -- name:'@1_r'\n"
        "┃        ┃     ┃     ┃     ┣─ Statements\n"
        "┃        ┃     ┃     ┃     ┃  └─ ForLoop\n"
        "┃        ┃     ┃     ┃     ┃     ├─ Assign\n"
        "┃        ┃     ┃     ┃     ┃     │  ├─ Var -- name:'@for3_ir'\n"
        "┃        ┃     ┃     ┃     ┃     │  └─ Int -- val:'0'\n"
        "┃        ┃     ┃     ┃     ┃     ├─ Var -- name:'@temp_3'\n"
        "┃        ┃     ┃     ┃     ┃     ├─ NULL\n"
        "┃        ┃     ┃     ┃     ┃     ┢─ Statements\n"
        "┃        ┃     ┃     ┃     ┃     ┃  └─ ArrayAssign\n"
        "┃        ┃     ┃     ┃     ┃     ┃     ├─ ArrayExpr\n"
        "┃        ┃     ┃     ┃     ┃     ┃     │  ┢─ Exprs\n"
        "┃        ┃     ┃     ┃     ┃     ┃     │  ┃  └─ Binop -- op:'+'\n"
        "┃        ┃     ┃     ┃     ┃     ┃     │  ┃     ├─ Binop -- op:'*'\n"
        "┃        ┃     ┃     ┃     ┃     ┃     │  ┃     │  ├─ Binop -- op:'+'\n"
        "┃        ┃     ┃     ┃     ┃     ┃     │  ┃     │  │  ├─ Binop -- op:'*'\n"
        "┃        ┃     ┃     ┃     ┃     ┃     │  ┃     │  │  │  ├─ Binop -- op:'+'\n"
        "┃        ┃     ┃     ┃     ┃     ┃     │  ┃     │  │  │  │  ├─ Binop -- op:'*'\n"
        "┃        ┃     ┃     ┃     ┃     ┃     │  ┃     │  │  │  │  │  ├─ Var -- name:'@for0_ik'\n"
        "┃        ┃     ┃     ┃     ┃     ┃     │  ┃     │  │  │  │  │  └─ Var -- name:'@1_k'\n"
        "┃        ┃     ┃     ┃     ┃     ┃     │  ┃     │  │  │  │  └─ Var -- name:'@for1_il'\n"
        "┃        ┃     ┃     ┃     ┃     ┃     │  ┃     │  │  │  └─ Var -- name:'@1_l'\n"
        "┃        ┃     ┃     ┃     ┃     ┃     │  ┃     │  │  └─ Var -- name:'@for2_in'\n"
        "┃        ┃     ┃     ┃     ┃     ┃     │  ┃     │  └─ Var -- name:'@1_n'\n"
        "┃        ┃     ┃     ┃     ┃     ┃     │  ┃     └─ Var -- name:'@for3_ir'\n"
        "┃        ┃     ┃     ┃     ┃     ┃     │  ┡─ NULL\n"
        "┃        ┃     ┃     ┃     ┃     ┃     │  └─ Var -- name:'@1_d'\n"
        "┃        ┃     ┃     ┃     ┃     ┃     └─ Binop -- op:'+'\n"
        "┃        ┃     ┃     ┃     ┃     ┃        ├─ ArrayExpr\n"
        "┃        ┃     ┃     ┃     ┃     ┃        │  ┢─ Exprs\n"
        "┃        ┃     ┃     ┃     ┃     ┃        │  ┃  └─ Binop -- op:'+'\n"
        "┃        ┃     ┃     ┃     ┃     ┃        │  ┃     ├─ Binop -- op:'*'\n"
        "┃        ┃     ┃     ┃     ┃     ┃        │  ┃     │  ├─ Binop -- op:'+'\n"
        "┃        ┃     ┃     ┃     ┃     ┃        │  ┃     │  │  ├─ Binop -- op:'*'\n"
        "┃        ┃     ┃     ┃     ┃     ┃        │  ┃     │  │  │  ├─ Binop -- op:'+'\n"
        "┃        ┃     ┃     ┃     ┃     ┃        │  ┃     │  │  │  │  ├─ Binop -- op:'*'\n"
        "┃        ┃     ┃     ┃     ┃     ┃        │  ┃     │  │  │  │  │  ├─ Var -- "
        "name:'@for0_ik'\n"
        "┃        ┃     ┃     ┃     ┃     ┃        │  ┃     │  │  │  │  │  └─ Var -- name:'@1_k'\n"
        "┃        ┃     ┃     ┃     ┃     ┃        │  ┃     │  │  │  │  └─ Var -- name:'@for1_il'\n"
        "┃        ┃     ┃     ┃     ┃     ┃        │  ┃     │  │  │  └─ Var -- name:'@1_l'\n"
        "┃        ┃     ┃     ┃     ┃     ┃        │  ┃     │  │  └─ Var -- name:'@for2_in'\n"
        "┃        ┃     ┃     ┃     ┃     ┃        │  ┃     │  └─ Var -- name:'@1_n'\n"
        "┃        ┃     ┃     ┃     ┃     ┃        │  ┃     └─ Var -- name:'@for3_ir'\n"
        "┃        ┃     ┃     ┃     ┃     ┃        │  ┡─ NULL\n"
        "┃        ┃     ┃     ┃     ┃     ┃        │  └─ Var -- name:'@1_c'\n"
        "┃        ┃     ┃     ┃     ┃     ┃        └─ Binop -- op:'*'\n"
        "┃        ┃     ┃     ┃     ┃     ┃           ├─ ArrayExpr\n"
        "┃        ┃     ┃     ┃     ┃     ┃           │  ┢─ Exprs\n"
        "┃        ┃     ┃     ┃     ┃     ┃           │  ┃  └─ Binop -- op:'+'\n"
        "┃        ┃     ┃     ┃     ┃     ┃           │  ┃     ├─ Binop -- op:'*'\n"
        "┃        ┃     ┃     ┃     ┃     ┃           │  ┃     │  ├─ Var -- name:'@for2_in'\n"
        "┃        ┃     ┃     ┃     ┃     ┃           │  ┃     │  └─ Var -- name:'@0_m'\n"
        "┃        ┃     ┃     ┃     ┃     ┃           │  ┃     └─ Var -- name:'@for3_ir'\n"
        "┃        ┃     ┃     ┃     ┃     ┃           │  ┡─ NULL\n"
        "┃        ┃     ┃     ┃     ┃     ┃           │  └─ Var -- name:'@0_a'\n"
        "┃        ┃     ┃     ┃     ┃     ┃           └─ ArrayExpr\n"
        "┃        ┃     ┃     ┃     ┃     ┃              ┢─ Exprs\n"
        "┃        ┃     ┃     ┃     ┃     ┃              ┃  └─ Binop -- op:'+'\n"
        "┃        ┃     ┃     ┃     ┃     ┃              ┃     ├─ Binop -- op:'*'\n"
        "┃        ┃     ┃     ┃     ┃     ┃              ┃     │  ├─ Var -- name:'@for2_in'\n"
        "┃        ┃     ┃     ┃     ┃     ┃              ┃     │  └─ Var -- name:'@0_m1'\n"
        "┃        ┃     ┃     ┃     ┃     ┃              ┃     └─ Var -- name:'@for3_ir'\n"
        "┃        ┃     ┃     ┃     ┃     ┃              ┡─ NULL\n"
        "┃        ┃     ┃     ┃     ┃     ┃              └─ Var -- name:'@0_b'\n"
        "┃        ┃     ┃     ┃     ┃     ┗─ NULL\n"
        "┃        ┃     ┃     ┃     ┗─ NULL\n"
        "┃        ┃     ┃     ┗─ NULL\n"
        "┃        ┃     ┗─ NULL\n"
        "┃        ┗─ NULL\n"
        "┣─ Declarations\n"
        "┃  └─ FunDef -- has_export:'1'\n"
        "┃     ├─ FunHeader -- type:'void'\n"
        "┃     │  ├─ Var -- name:'__init'\n"
        "┃     │  └─ NULL\n"
        "┃     └─ FunBody\n"
        "┃        ┢─ VarDecs\n"
        "┃        ┃  └─ VarDec -- type:'int'\n"
        "┃        ┃     ├─ Var -- name:'@loop_dims0'\n"
        "┃        ┃     └─ NULL\n"
        "┃        ┡─ NULL\n"
        "┃        ├─ NULL\n"
        "┃        ┢─ Statements\n"
        "┃        ┃  └─ Assign\n"
        "┃        ┃     ├─ Var -- name:'@loop_dims0'\n"
        "┃        ┃     └─ Binop -- op:'*'\n"
        "┃        ┃        ├─ Var -- name:'@0_m'\n"
        "┃        ┃        └─ Var -- name:'@0_n'\n"
        "┃        ┣─ Statements\n"
        "┃        ┃  └─ Assign\n"
        "┃        ┃     ├─ Var -- name:'@0_a'\n"
        "┃        ┃     └─ ProcCall\n"
        "┃        ┃        ├─ Var -- name:'@alloc'\n"
        "┃        ┃        ┢─ Exprs\n"
        "┃        ┃        ┃  └─ Var -- name:'@loop_dims0'\n"
        "┃        ┃        ┗─ NULL\n"
        "┃        ┗─ NULL\n"
        "┗─ NULL\n";

    ASSERT_MLSTREQ(expected, root_string);

    expected =
        "┌─ 0: Program\n"
        "├─ __init: FunHeader -- type:'void' -- Params: (null)\n"
        "├─ @0_a: VarDec -- type:'int'\n"
        "├─ @0_b: GlobalDec -- type:'int'\n"
        "├─ @0_m: VarDec -- type:'int'\n"
        "├─ @0_n: VarDec -- type:'int'\n"
        "├─ @fun_test: FunHeader -- type:'void' -- Params: int (Var -- name:'@1_r'), int (Var -- "
        "name:'@1_n'), int (Var -- name:'@1_l'), int (Var -- name:'@1_k'), int (ArrayVar)\n"
        "├─ @0_m1: DimensionVars\n"
        "├─ @0_n2: DimensionVars\n"
        "└────────────────────\n"
        "\n"
        "┌─ 1: FunDef '@fun_test' -- parent: '0: Program'\n"
        "├─ @loop_dims0: VarDec -- type:'int'\n"
        "├─ @for0_ik: VarDec -- type:'int'\n"
        "├─ @1_c: Params -- type:'int'\n"
        "├─ @1_d: VarDec -- type:'int'\n"
        "├─ @1_k: DimensionVars\n"
        "├─ @1_l: DimensionVars\n"
        "├─ @1_n: DimensionVars\n"
        "├─ @1_r: DimensionVars\n"
        "├─ @loop_expr0: VarDec -- type:'int'\n"
        "├─ @for1_il: VarDec -- type:'int'\n"
        "├─ @for2_in: VarDec -- type:'int'\n"
        "├─ @temp_0: VarDec -- type:'int'\n"
        "├─ @temp_1: VarDec -- type:'int'\n"
        "├─ @temp_2: VarDec -- type:'int'\n"
        "├─ @temp_3: VarDec -- type:'int'\n"
        "├─ @loop_var0: VarDec -- type:'int'\n"
        "├─ @for3_ir: VarDec -- type:'int'\n"
        "└────────────────────\n"
        "\n"
        "┌─ 1: FunDef '__init' -- parent: '0: Program'\n"
        "├─ @loop_dims0: VarDec -- type:'int'\n"
        "└────────────────────\n";

    ASSERT_MLSTREQ(expected, symbols_string);
}

TEST_F(CodeGenPrepTest, ArrTwoArrParams)
{
    SetUp("milestone_8/two_arr_params/main.cvc");
    ASSERT_NE(nullptr, root);

    const char *expected = "Program\n"
                           "┢─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'0'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'@fun_fun'\n"
                           "┃     │  ┢─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_d'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_c'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_b'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_a'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ ArrayVar\n"
                           "┃     │  ┃     ┢─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_a'\n"
                           "┃     │  ┃     ┣─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_b'\n"
                           "┃     │  ┃     ┡─ NULL\n"
                           "┃     │  ┃     └─ Var -- name:'@1_arr1'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ ArrayVar\n"
                           "┃     │  ┃     ┢─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_c'\n"
                           "┃     │  ┃     ┣─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_d'\n"
                           "┃     │  ┃     ┡─ NULL\n"
                           "┃     │  ┃     └─ Var -- name:'@1_arr2'\n"
                           "┃     │  ┗─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ┢─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@1_i'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┡─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        ┢─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@1_i'\n"
                           "┃        ┃     └─ Int -- val:'1'\n"
                           "┃        ┗─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'1'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'__init'\n"
                           "┃     │  └─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ├─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        └─ NULL\n"
                           "┗─ NULL\n";

    ASSERT_MLSTREQ(expected, root_string);

    expected = "┌─ 0: Program\n"
               "├─ __init: FunHeader -- type:'void' -- Params: (null)\n"
               "├─ @fun_fun: FunHeader -- type:'void' -- Params: int (Var -- name:'@1_d'), int "
               "(Var -- name:'@1_c'), int (Var -- name:'@1_b'), int (Var -- name:'@1_a'), int "
               "(ArrayVar), int (ArrayVar)\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '@fun_fun' -- parent: '0: Program'\n"
               "├─ @1_a: DimensionVars\n"
               "├─ @1_b: DimensionVars\n"
               "├─ @1_c: DimensionVars\n"
               "├─ @1_d: DimensionVars\n"
               "├─ @1_i: VarDec -- type:'int'\n"
               "├─ @1_arr1: Params -- type:'int'\n"
               "├─ @1_arr2: Params -- type:'int'\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '__init' -- parent: '0: Program'\n"
               "└────────────────────\n";

    ASSERT_MLSTREQ(expected, symbols_string);
}

TEST_F(CodeGenPrepTest, ArrTwoArrProccall)
{
    SetUp("milestone_8/two_arr_proccall/main.cvc");
    ASSERT_NE(nullptr, root);

    const char *expected = "Program\n"
                           "┢─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'0'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'@fun_fun_one'\n"
                           "┃     │  ┢─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_d'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_c'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_b'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_a'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ ArrayVar\n"
                           "┃     │  ┃     ┢─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_a'\n"
                           "┃     │  ┃     ┣─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_b'\n"
                           "┃     │  ┃     ┡─ NULL\n"
                           "┃     │  ┃     └─ Var -- name:'@1_arr1'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ ArrayVar\n"
                           "┃     │  ┃     ┢─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_c'\n"
                           "┃     │  ┃     ┣─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_d'\n"
                           "┃     │  ┃     ┡─ NULL\n"
                           "┃     │  ┃     └─ Var -- name:'@1_arr2'\n"
                           "┃     │  ┗─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ┢─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@1_i'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┡─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        ┢─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@1_i'\n"
                           "┃        ┃     └─ Int -- val:'1'\n"
                           "┃        ┗─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'0'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'@fun_fun_two'\n"
                           "┃     │  ┢─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_h'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_g'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_f'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_e'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ ArrayVar\n"
                           "┃     │  ┃     ┢─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_e'\n"
                           "┃     │  ┃     ┣─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_f'\n"
                           "┃     │  ┃     ┡─ NULL\n"
                           "┃     │  ┃     └─ Var -- name:'@1_arr3'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ ArrayVar\n"
                           "┃     │  ┃     ┢─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_g'\n"
                           "┃     │  ┃     ┣─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_h'\n"
                           "┃     │  ┃     ┡─ NULL\n"
                           "┃     │  ┃     └─ Var -- name:'@1_arr4'\n"
                           "┃     │  ┗─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ├─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        ┢─ Statements\n"
                           "┃        ┃  └─ ProcCall\n"
                           "┃        ┃     ├─ Var -- name:'@fun_fun_one'\n"
                           "┃        ┃     ┢─ Exprs\n"
                           "┃        ┃     ┃  └─ Var -- name:'@1_h'\n"
                           "┃        ┃     ┣─ Exprs\n"
                           "┃        ┃     ┃  └─ Var -- name:'@1_g'\n"
                           "┃        ┃     ┣─ Exprs\n"
                           "┃        ┃     ┃  └─ Var -- name:'@1_f'\n"
                           "┃        ┃     ┣─ Exprs\n"
                           "┃        ┃     ┃  └─ Var -- name:'@1_e'\n"
                           "┃        ┃     ┣─ Exprs\n"
                           "┃        ┃     ┃  └─ Var -- name:'@1_arr3'\n"
                           "┃        ┃     ┣─ Exprs\n"
                           "┃        ┃     ┃  └─ Var -- name:'@1_arr4'\n"
                           "┃        ┃     ┗─ NULL\n"
                           "┃        ┗─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'1'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'__init'\n"
                           "┃     │  └─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ├─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        └─ NULL\n"
                           "┗─ NULL\n";

    ASSERT_MLSTREQ(expected, root_string);

    expected = "┌─ 0: Program\n"
               "├─ __init: FunHeader -- type:'void' -- Params: (null)\n"
               "├─ @fun_fun_one: FunHeader -- type:'void' -- Params: int (Var -- name:'@1_d'), int "
               "(Var -- name:'@1_c'), int (Var -- name:'@1_b'), int (Var -- name:'@1_a'), int "
               "(ArrayVar), int (ArrayVar)\n"
               "├─ @fun_fun_two: FunHeader -- type:'void' -- Params: int (Var -- name:'@1_h'), int "
               "(Var -- name:'@1_g'), int (Var -- name:'@1_f'), int (Var -- name:'@1_e'), int "
               "(ArrayVar), int (ArrayVar)\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '@fun_fun_one' -- parent: '0: Program'\n"
               "├─ @1_a: DimensionVars\n"
               "├─ @1_b: DimensionVars\n"
               "├─ @1_c: DimensionVars\n"
               "├─ @1_d: DimensionVars\n"
               "├─ @1_i: VarDec -- type:'int'\n"
               "├─ @1_arr1: Params -- type:'int'\n"
               "├─ @1_arr2: Params -- type:'int'\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '@fun_fun_two' -- parent: '0: Program'\n"
               "├─ @1_e: DimensionVars\n"
               "├─ @1_f: DimensionVars\n"
               "├─ @1_g: DimensionVars\n"
               "├─ @1_h: DimensionVars\n"
               "├─ @1_arr3: Params -- type:'int'\n"
               "├─ @1_arr4: Params -- type:'int'\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '__init' -- parent: '0: Program'\n"
               "└────────────────────\n";

    ASSERT_MLSTREQ(expected, symbols_string);
}

TEST_F(CodeGenPrepTest, ArrDoubleArrProccall)
{
    SetUp("milestone_8/double_arr_proccall/main.cvc");
    ASSERT_NE(nullptr, root);

    const char *expected = "Program\n"
                           "┢─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'0'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'@fun_fun'\n"
                           "┃     │  ┢─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_d'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_c'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_b'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_a'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ ArrayVar\n"
                           "┃     │  ┃     ┢─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_a'\n"
                           "┃     │  ┃     ┣─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_b'\n"
                           "┃     │  ┃     ┡─ NULL\n"
                           "┃     │  ┃     └─ Var -- name:'@1_arr1'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ ArrayVar\n"
                           "┃     │  ┃     ┢─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_c'\n"
                           "┃     │  ┃     ┣─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_d'\n"
                           "┃     │  ┃     ┡─ NULL\n"
                           "┃     │  ┃     └─ Var -- name:'@1_arr2'\n"
                           "┃     │  ┗─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ├─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        ┢─ Statements\n"
                           "┃        ┃  └─ ProcCall\n"
                           "┃        ┃     ├─ Var -- name:'@fun_fun2'\n"
                           "┃        ┃     ┢─ Exprs\n"
                           "┃        ┃     ┃  └─ Var -- name:'@1_b'\n"
                           "┃        ┃     ┣─ Exprs\n"
                           "┃        ┃     ┃  └─ Var -- name:'@1_a'\n"
                           "┃        ┃     ┣─ Exprs\n"
                           "┃        ┃     ┃  └─ Var -- name:'@1_b'\n"
                           "┃        ┃     ┣─ Exprs\n"
                           "┃        ┃     ┃  └─ Var -- name:'@1_a'\n"
                           "┃        ┃     ┣─ Exprs\n"
                           "┃        ┃     ┃  └─ Var -- name:'@1_arr1'\n"
                           "┃        ┃     ┣─ Exprs\n"
                           "┃        ┃     ┃  └─ Var -- name:'@1_arr1'\n"
                           "┃        ┃     ┗─ NULL\n"
                           "┃        ┗─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'0'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'@fun_fun2'\n"
                           "┃     │  ┢─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_h'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_g'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_f'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ Var -- name:'@1_e'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ ArrayVar\n"
                           "┃     │  ┃     ┢─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_e'\n"
                           "┃     │  ┃     ┣─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_f'\n"
                           "┃     │  ┃     ┡─ NULL\n"
                           "┃     │  ┃     └─ Var -- name:'@1_arr3'\n"
                           "┃     │  ┣─ Params -- type:'int'\n"
                           "┃     │  ┃  └─ ArrayVar\n"
                           "┃     │  ┃     ┢─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_g'\n"
                           "┃     │  ┃     ┣─ DimensionVars\n"
                           "┃     │  ┃     ┃  └─ Var -- name:'@1_h'\n"
                           "┃     │  ┃     ┡─ NULL\n"
                           "┃     │  ┃     └─ Var -- name:'@1_arr4'\n"
                           "┃     │  ┗─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ┢─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@1_i'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┡─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        ┢─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@1_i'\n"
                           "┃        ┃     └─ Int -- val:'1'\n"
                           "┃        ┗─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'1'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'__init'\n"
                           "┃     │  └─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ├─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        └─ NULL\n"
                           "┗─ NULL\n";

    ASSERT_MLSTREQ(expected, root_string);

    expected = "┌─ 0: Program\n"
               "├─ __init: FunHeader -- type:'void' -- Params: (null)\n"
               "├─ @fun_fun2: FunHeader -- type:'void' -- Params: int (Var -- name:'@1_h'), int "
               "(Var -- name:'@1_g'), int (Var -- name:'@1_f'), int (Var -- name:'@1_e'), int "
               "(ArrayVar), int (ArrayVar)\n"
               "├─ @fun_fun: FunHeader -- type:'void' -- Params: int (Var -- name:'@1_d'), int "
               "(Var -- name:'@1_c'), int (Var -- name:'@1_b'), int (Var -- name:'@1_a'), int "
               "(ArrayVar), int (ArrayVar)\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '@fun_fun' -- parent: '0: Program'\n"
               "├─ @1_a: DimensionVars\n"
               "├─ @1_b: DimensionVars\n"
               "├─ @1_c: DimensionVars\n"
               "├─ @1_d: DimensionVars\n"
               "├─ @1_arr1: Params -- type:'int'\n"
               "├─ @1_arr2: Params -- type:'int'\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '@fun_fun2' -- parent: '0: Program'\n"
               "├─ @1_e: DimensionVars\n"
               "├─ @1_f: DimensionVars\n"
               "├─ @1_g: DimensionVars\n"
               "├─ @1_h: DimensionVars\n"
               "├─ @1_i: VarDec -- type:'int'\n"
               "├─ @1_arr3: Params -- type:'int'\n"
               "├─ @1_arr4: Params -- type:'int'\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '__init' -- parent: '0: Program'\n"
               "└────────────────────\n";

    ASSERT_MLSTREQ(expected, symbols_string);
}

TEST_F(CodeGenPrepTest, Functional_Assignment01_Array)
{
    SetUp("functional/assignment_01/array.cvc");
    ASSERT_NE(nullptr, root);

    // To long to check
    // ASSERT_MLSTREQ(expected, root_string);

    const char *expected =
        "┌─ 0: Program\n"
        "├─ @fun_scanFloat: FunHeader -- type:'float' -- Params: (null)\n"
        "├─ __init: FunHeader -- type:'void' -- Params: (null)\n"
        "├─ @fun_scanFloatVec: FunHeader -- type:'void' -- Params: int (Var -- name:'@1_n'), float "
        "(ArrayVar)\n"
        "├─ @fun_printIntVec: FunHeader -- type:'void' -- Params: int (Var -- name:'@1_n'), int "
        "(ArrayVar)\n"
        "├─ @fun_printFloatMat: FunHeader -- type:'void' -- Params: int (Var -- name:'@1_n'), int "
        "(Var -- name:'@1_m'), float (ArrayVar)\n"
        "├─ @fun_scanIntMat: FunHeader -- type:'void' -- Params: int (Var -- name:'@1_n'), int "
        "(Var -- name:'@1_m'), int (ArrayVar)\n"
        "├─ @fun_printFloatVec: FunHeader -- type:'void' -- Params: int (Var -- name:'@1_n'), "
        "float (ArrayVar)\n"
        "├─ @fun_printInt: FunHeader -- type:'void' -- Params: int (Var -- name:'@0_val')\n"
        "├─ @fun_scanInt: FunHeader -- type:'int' -- Params: (null)\n"
        "├─ @fun_scanIntVec: FunHeader -- type:'void' -- Params: int (Var -- name:'@1_n'), int "
        "(ArrayVar)\n"
        "├─ @fun_matMul: FunHeader -- type:'bool' -- Params: int (Var -- name:'@1_l'), int (Var -- "
        "name:'@1_q'), int (Var -- name:'@1_p'), int (Var -- name:'@1_o'), int (Var -- "
        "name:'@1_n'), int (Var -- name:'@1_m'), float (ArrayVar), float (ArrayVar), float "
        "(ArrayVar)\n"
        "├─ @fun_printNewlines: FunHeader -- type:'void' -- Params: int (Var -- name:'@0_num')\n"
        "├─ @fun_scanFloatMat: FunHeader -- type:'void' -- Params: int (Var -- name:'@1_n'), int "
        "(Var -- name:'@1_m'), float (ArrayVar)\n"
        "├─ @fun_queens: FunHeader -- type:'bool' -- Params: int (Var -- name:'@1_n'), int (Var -- "
        "name:'@1_m'), bool (ArrayVar)\n"
        "├─ @fun_printIntMat: FunHeader -- type:'void' -- Params: int (Var -- name:'@1_n'), int "
        "(Var -- name:'@1_m'), int (ArrayVar)\n"
        "├─ @fun_printSpaces: FunHeader -- type:'void' -- Params: int (Var -- name:'@0_num')\n"
        "├─ @fun_printFloat: FunHeader -- type:'void' -- Params: float (Var -- name:'@0_val')\n"
        "└────────────────────\n"
        "\n"
        "┌─ 1: FunDef '@fun_printIntVec' -- parent: '0: Program'\n"
        "├─ @1_n: DimensionVars\n"
        "├─ @1_vec: Params -- type:'int'\n"
        "├─ @temp_0: VarDec -- type:'int'\n"
        "├─ @for0_i: VarDec -- type:'int'\n"
        "└────────────────────\n"
        "\n"
        "┌─ 1: FunDef '@fun_printFloatVec' -- parent: '0: Program'\n"
        "├─ @1_n: DimensionVars\n"
        "├─ @1_vec: Params -- type:'float'\n"
        "├─ @temp_0: VarDec -- type:'int'\n"
        "├─ @for0_i: VarDec -- type:'int'\n"
        "└────────────────────\n"
        "\n"
        "┌─ 1: FunDef '@fun_printIntMat' -- parent: '0: Program'\n"
        "├─ @for1_j: VarDec -- type:'int'\n"
        "├─ @1_mat: Params -- type:'int'\n"
        "├─ @1_m: DimensionVars\n"
        "├─ @1_n: DimensionVars\n"
        "├─ @temp_0: VarDec -- type:'int'\n"
        "├─ @temp_1: VarDec -- type:'int'\n"
        "├─ @for0_i: VarDec -- type:'int'\n"
        "└────────────────────\n"
        "\n"
        "┌─ 1: FunDef '@fun_printFloatMat' -- parent: '0: Program'\n"
        "├─ @for1_j: VarDec -- type:'int'\n"
        "├─ @1_mat: Params -- type:'float'\n"
        "├─ @1_m: DimensionVars\n"
        "├─ @1_n: DimensionVars\n"
        "├─ @temp_0: VarDec -- type:'int'\n"
        "├─ @temp_1: VarDec -- type:'int'\n"
        "├─ @for0_i: VarDec -- type:'int'\n"
        "└────────────────────\n"
        "\n"
        "┌─ 1: FunDef '@fun_scanIntVec' -- parent: '0: Program'\n"
        "├─ @1_n: DimensionVars\n"
        "├─ @1_vec: Params -- type:'int'\n"
        "├─ @temp_0: VarDec -- type:'int'\n"
        "├─ @for0_i: VarDec -- type:'int'\n"
        "└────────────────────\n"
        "\n"
        "┌─ 1: FunDef '@fun_scanFloatVec' -- parent: '0: Program'\n"
        "├─ @1_n: DimensionVars\n"
        "├─ @1_vec: Params -- type:'float'\n"
        "├─ @temp_0: VarDec -- type:'int'\n"
        "├─ @for0_i: VarDec -- type:'int'\n"
        "└────────────────────\n"
        "\n"
        "┌─ 1: FunDef '@fun_scanIntMat' -- parent: '0: Program'\n"
        "├─ @for1_j: VarDec -- type:'int'\n"
        "├─ @1_mat: Params -- type:'int'\n"
        "├─ @1_m: DimensionVars\n"
        "├─ @1_n: DimensionVars\n"
        "├─ @temp_0: VarDec -- type:'int'\n"
        "├─ @temp_1: VarDec -- type:'int'\n"
        "├─ @for0_i: VarDec -- type:'int'\n"
        "└────────────────────\n"
        "\n"
        "┌─ 1: FunDef '@fun_scanFloatMat' -- parent: '0: Program'\n"
        "├─ @for1_j: VarDec -- type:'int'\n"
        "├─ @1_mat: Params -- type:'float'\n"
        "├─ @1_m: DimensionVars\n"
        "├─ @1_n: DimensionVars\n"
        "├─ @temp_0: VarDec -- type:'int'\n"
        "├─ @temp_1: VarDec -- type:'int'\n"
        "├─ @for0_i: VarDec -- type:'int'\n"
        "└────────────────────\n"
        "\n"
        "┌─ 1: FunDef '@fun_matMul' -- parent: '0: Program'\n"
        "├─ @for4_ik: VarDec -- type:'int'\n"
        "├─ @for0_im: VarDec -- type:'int'\n"
        "├─ @1_a: Params -- type:'float'\n"
        "├─ @1_b: Params -- type:'float'\n"
        "├─ @1_c: Params -- type:'float'\n"
        "├─ @1_l: DimensionVars\n"
        "├─ @1_m: DimensionVars\n"
        "├─ @1_n: DimensionVars\n"
        "├─ @1_o: DimensionVars\n"
        "├─ @1_p: DimensionVars\n"
        "├─ @1_q: DimensionVars\n"
        "├─ @for1_ik: VarDec -- type:'int'\n"
        "├─ @for2_im: VarDec -- type:'int'\n"
        "├─ @temp_0: VarDec -- type:'int'\n"
        "├─ @temp_1: VarDec -- type:'int'\n"
        "├─ @temp_2: VarDec -- type:'int'\n"
        "├─ @temp_3: VarDec -- type:'int'\n"
        "├─ @temp_4: VarDec -- type:'int'\n"
        "├─ @for3_in: VarDec -- type:'int'\n"
        "└────────────────────\n"
        "\n"
        "┌─ 1: FunDef '@fun_queens' -- parent: '0: Program'\n"
        "├─ @1_field: Params -- type:'bool'\n"
        "├─ @loop_dims0: VarDec -- type:'int'\n"
        "├─ @loop_dims1: VarDec -- type:'int'\n"
        "├─ @loop_dims2: VarDec -- type:'int'\n"
        "├─ @1_diagnolPositive: VarDec -- type:'int'\n"
        "├─ @fun_contains: FunHeader -- type:'bool' -- Params: int (Var -- name:'@2_m'), int "
        "(ArrayVar), int (Var -- name:'@2_value')\n"
        "├─ @for0_im: VarDec -- type:'int'\n"
        "├─ @1_m: DimensionVars\n"
        "├─ @1_n: DimensionVars\n"
        "├─ @loop_expr0: VarDec -- type:'int'\n"
        "├─ @loop_expr1: VarDec -- type:'int'\n"
        "├─ @loop_expr2: VarDec -- type:'int'\n"
        "├─ @fun_solveQueens: FunHeader -- type:'bool' -- Params: int (Var -- name:'@2_im')\n"
        "├─ @1_rows: VarDec -- type:'int'\n"
        "├─ @fun_isValid: FunHeader -- type:'bool' -- Params: (null)\n"
        "├─ @temp_0: VarDec -- type:'int'\n"
        "├─ @temp_1: VarDec -- type:'int'\n"
        "├─ @loop_var0: VarDec -- type:'int'\n"
        "├─ @loop_var1: VarDec -- type:'int'\n"
        "├─ @loop_var2: VarDec -- type:'int'\n"
        "├─ @1_diagnolNegative: VarDec -- type:'int'\n"
        "├─ @1_startIndex: VarDec -- type:'int'\n"
        "└────────────────────\n"
        "\n"
        "┌─ 2: FunDef '@fun_contains' -- parent: '1: FunDef '@fun_queens''\n"
        "├─ @2_value: Params -- type:'int'\n"
        "├─ @2_m: DimensionVars\n"
        "├─ @temp_0: VarDec -- type:'int'\n"
        "├─ @2_array: Params -- type:'int'\n"
        "├─ @for0_i: VarDec -- type:'int'\n"
        "└────────────────────\n"
        "\n"
        "┌─ 2: FunDef '@fun_isValid' -- parent: '1: FunDef '@fun_queens''\n"
        "├─ @for0_im: VarDec -- type:'int'\n"
        "├─ @for1_in: VarDec -- type:'int'\n"
        "├─ @temp_0: VarDec -- type:'int'\n"
        "├─ @temp_1: VarDec -- type:'int'\n"
        "└────────────────────\n"
        "\n"
        "┌─ 2: FunDef '@fun_solveQueens' -- parent: '1: FunDef '@fun_queens''\n"
        "├─ @for0_in: VarDec -- type:'int'\n"
        "├─ @2_im: Params -- type:'int'\n"
        "├─ @temp_0: VarDec -- type:'int'\n"
        "└────────────────────\n"
        "\n"
        "┌─ 1: FunDef '__init' -- parent: '0: Program'\n"
        "└────────────────────\n";

    ASSERT_MLSTREQ(expected, symbols_string);
}

TEST_F(CodeGenPrepTest, EdgeCasesValid)
{
    SetUp("preperation/edgecase/valid.cvc");
    ASSERT_NE(nullptr, root);

    const char *expected = "Program\n"
                           "┢─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'int'\n"
                           "┃        ├─ Var -- name:'@temp_1'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'int'\n"
                           "┃        ├─ Var -- name:'@temp_0'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDec -- type:'float'\n"
                           "┃     └─ Var -- name:'@0_m'\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'1'\n"
                           "┃     └─ VarDec -- type:'int'\n"
                           "┃        ├─ Var -- name:'@0_nine'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDec -- type:'float'\n"
                           "┃     └─ Var -- name:'@0_e'\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDec -- type:'int'\n"
                           "┃     └─ Var -- name:'@0_t'\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'bool'\n"
                           "┃        ├─ Var -- name:'@0_b'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'1'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'@fun_e'\n"
                           "┃     │  └─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ┢─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims0'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'bool'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_expr0'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_var0'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'bool'\n"
                           "┃        ┃     ├─ ArrayExpr\n"
                           "┃        ┃     │  ┢─ Exprs\n"
                           "┃        ┃     │  ┃  └─ Var -- name:'@0_nine'\n"
                           "┃        ┃     │  ┡─ NULL\n"
                           "┃        ┃     │  └─ Var -- name:'@1_nine'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'bool'\n"
                           "┃        ┃     ├─ Var -- name:'@1_a'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┡─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        ┢─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims0'\n"
                           "┃        ┃     └─ Var -- name:'@0_nine'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@1_nine'\n"
                           "┃        ┃     └─ ProcCall\n"
                           "┃        ┃        ├─ Var -- name:'@alloc'\n"
                           "┃        ┃        ┢─ Exprs\n"
                           "┃        ┃        ┃  └─ Var -- name:'@loop_dims0'\n"
                           "┃        ┃        ┗─ NULL\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@loop_expr0'\n"
                           "┃        ┃     └─ Var -- name:'@0_b'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ForLoop\n"
                           "┃        ┃     ├─ Assign\n"
                           "┃        ┃     │  ├─ Var -- name:'@loop_var0'\n"
                           "┃        ┃     │  └─ Int -- val:'0'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims0'\n"
                           "┃        ┃     ├─ NULL\n"
                           "┃        ┃     ┢─ Statements\n"
                           "┃        ┃     ┃  └─ ArrayAssign\n"
                           "┃        ┃     ┃     ├─ ArrayExpr\n"
                           "┃        ┃     ┃     │  ┢─ Exprs\n"
                           "┃        ┃     ┃     │  ┃  └─ Var -- name:'@loop_var0'\n"
                           "┃        ┃     ┃     │  ┡─ NULL\n"
                           "┃        ┃     ┃     │  └─ Var -- name:'@1_nine'\n"
                           "┃        ┃     ┃     └─ Var -- name:'@loop_expr0'\n"
                           "┃        ┃     ┗─ NULL\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@1_a'\n"
                           "┃        ┃     └─ ArrayExpr\n"
                           "┃        ┃        ┢─ Exprs\n"
                           "┃        ┃        ┃  └─ Int -- val:'0'\n"
                           "┃        ┃        ┡─ NULL\n"
                           "┃        ┃        └─ Var -- name:'@1_nine'\n"
                           "┃        ┗─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'1'\n"
                           "┃     └─ VarDec -- type:'float'\n"
                           "┃        ├─ ArrayExpr\n"
                           "┃        │  ┢─ Exprs\n"
                           "┃        │  ┃  └─ Var -- name:'@temp_0'\n"
                           "┃        │  ┡─ NULL\n"
                           "┃        │  └─ Var -- name:'@0_p'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'0'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'@fun_m'\n"
                           "┃     │  └─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ├─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'1'\n"
                           "┃     └─ VarDec -- type:'int'\n"
                           "┃        ├─ ArrayExpr\n"
                           "┃        │  ┢─ Exprs\n"
                           "┃        │  ┃  └─ Var -- name:'@temp_1'\n"
                           "┃        │  ┡─ NULL\n"
                           "┃        │  └─ Var -- name:'@0_f'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDec -- type:'float'\n"
                           "┃     └─ Var -- name:'@0_c'\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'int'\n"
                           "┃        ├─ Var -- name:'@0_bef'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ GlobalDef -- has_export:'0'\n"
                           "┃     └─ VarDec -- type:'int'\n"
                           "┃        ├─ Var -- name:'@0_after'\n"
                           "┃        └─ NULL\n"
                           "┣─ Declarations\n"
                           "┃  └─ FunDef -- has_export:'1'\n"
                           "┃     ├─ FunHeader -- type:'void'\n"
                           "┃     │  ├─ Var -- name:'__init'\n"
                           "┃     │  └─ NULL\n"
                           "┃     └─ FunBody\n"
                           "┃        ┢─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims0'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'float'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_expr0'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_var0'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims1'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_expr1'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┣─ VarDecs\n"
                           "┃        ┃  └─ VarDec -- type:'int'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_var1'\n"
                           "┃        ┃     └─ NULL\n"
                           "┃        ┡─ NULL\n"
                           "┃        ├─ NULL\n"
                           "┃        ┢─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims0'\n"
                           "┃        ┃     └─ Var -- name:'@temp_0'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@0_p'\n"
                           "┃        ┃     └─ ProcCall\n"
                           "┃        ┃        ├─ Var -- name:'@alloc'\n"
                           "┃        ┃        ┢─ Exprs\n"
                           "┃        ┃        ┃  └─ Var -- name:'@loop_dims0'\n"
                           "┃        ┃        ┗─ NULL\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@loop_expr0'\n"
                           "┃        ┃     └─ Float -- val:'0.000000'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ForLoop\n"
                           "┃        ┃     ├─ Assign\n"
                           "┃        ┃     │  ├─ Var -- name:'@loop_var0'\n"
                           "┃        ┃     │  └─ Int -- val:'0'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims0'\n"
                           "┃        ┃     ├─ NULL\n"
                           "┃        ┃     ┢─ Statements\n"
                           "┃        ┃     ┃  └─ ArrayAssign\n"
                           "┃        ┃     ┃     ├─ ArrayExpr\n"
                           "┃        ┃     ┃     │  ┢─ Exprs\n"
                           "┃        ┃     ┃     │  ┃  └─ Var -- name:'@loop_var0'\n"
                           "┃        ┃     ┃     │  ┡─ NULL\n"
                           "┃        ┃     ┃     │  └─ Var -- name:'@0_p'\n"
                           "┃        ┃     ┃     └─ Var -- name:'@loop_expr0'\n"
                           "┃        ┃     ┗─ NULL\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims1'\n"
                           "┃        ┃     └─ Var -- name:'@temp_1'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@0_f'\n"
                           "┃        ┃     └─ ProcCall\n"
                           "┃        ┃        ├─ Var -- name:'@alloc'\n"
                           "┃        ┃        ┢─ Exprs\n"
                           "┃        ┃        ┃  └─ Var -- name:'@loop_dims1'\n"
                           "┃        ┃        ┗─ NULL\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@loop_expr1'\n"
                           "┃        ┃     └─ Int -- val:'0'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ ForLoop\n"
                           "┃        ┃     ├─ Assign\n"
                           "┃        ┃     │  ├─ Var -- name:'@loop_var1'\n"
                           "┃        ┃     │  └─ Int -- val:'0'\n"
                           "┃        ┃     ├─ Var -- name:'@loop_dims1'\n"
                           "┃        ┃     ├─ NULL\n"
                           "┃        ┃     ┢─ Statements\n"
                           "┃        ┃     ┃  └─ ArrayAssign\n"
                           "┃        ┃     ┃     ├─ ArrayExpr\n"
                           "┃        ┃     ┃     │  ┢─ Exprs\n"
                           "┃        ┃     ┃     │  ┃  └─ Var -- name:'@loop_var1'\n"
                           "┃        ┃     ┃     │  ┡─ NULL\n"
                           "┃        ┃     ┃     │  └─ Var -- name:'@0_f'\n"
                           "┃        ┃     ┃     └─ Var -- name:'@loop_expr1'\n"
                           "┃        ┃     ┗─ NULL\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@temp_0'\n"
                           "┃        ┃     └─ Int -- val:'0'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@temp_1'\n"
                           "┃        ┃     └─ Int -- val:'0'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@0_b'\n"
                           "┃        ┃     └─ Ternary\n"
                           "┃        ┃        ├─ Binop -- op:'!='\n"
                           "┃        ┃        │  ├─ Var -- name:'@0_e'\n"
                           "┃        ┃        │  └─ Float -- val:'0.000000'\n"
                           "┃        ┃        ├─ Bool -- val:'1'\n"
                           "┃        ┃        └─ Bool -- val:'0'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@0_bef'\n"
                           "┃        ┃     └─ Int -- val:'0'\n"
                           "┃        ┣─ Statements\n"
                           "┃        ┃  └─ Assign\n"
                           "┃        ┃     ├─ Var -- name:'@0_after'\n"
                           "┃        ┃     └─ Var -- name:'@0_bef'\n"
                           "┃        ┗─ NULL\n"
                           "┗─ NULL\n";

    ASSERT_MLSTREQ(expected, root_string);

    expected = "┌─ 0: Program\n"
               "├─ __init: FunHeader -- type:'void' -- Params: (null)\n"
               "├─ @0_b: VarDec -- type:'bool'\n"
               "├─ @0_c: GlobalDec -- type:'float'\n"
               "├─ @0_e: GlobalDec -- type:'float'\n"
               "├─ @0_f: VarDec -- type:'int'\n"
               "├─ @0_nine: VarDec -- type:'int'\n"
               "├─ @0_m: GlobalDec -- type:'float'\n"
               "├─ @0_p: VarDec -- type:'float'\n"
               "├─ @0_after: VarDec -- type:'int'\n"
               "├─ @0_t: GlobalDec -- type:'int'\n"
               "├─ @fun_e: FunHeader -- type:'void' -- Params: (null)\n"
               "├─ @fun_m: FunHeader -- type:'void' -- Params: (null)\n"
               "├─ @0_bef: VarDec -- type:'int'\n"
               "├─ @temp_0: VarDec -- type:'int'\n"
               "├─ @temp_1: VarDec -- type:'int'\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '@fun_e' -- parent: '0: Program'\n"
               "├─ @loop_dims0: VarDec -- type:'int'\n"
               "├─ @1_a: VarDec -- type:'bool'\n"
               "├─ @loop_expr0: VarDec -- type:'bool'\n"
               "├─ @1_nine: VarDec -- type:'bool'\n"
               "├─ @loop_var0: VarDec -- type:'int'\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '@fun_m' -- parent: '0: Program'\n"
               "└────────────────────\n"
               "\n"
               "┌─ 1: FunDef '__init' -- parent: '0: Program'\n"
               "├─ @loop_dims0: VarDec -- type:'int'\n"
               "├─ @loop_dims1: VarDec -- type:'int'\n"
               "├─ @loop_expr0: VarDec -- type:'float'\n"
               "├─ @loop_expr1: VarDec -- type:'int'\n"
               "├─ @loop_var0: VarDec -- type:'int'\n"
               "├─ @loop_var1: VarDec -- type:'int'\n"
               "└────────────────────\n";

    ASSERT_MLSTREQ(expected, symbols_string);
}

// /////////////////////////
// COMPILATION FAILURE tests
// /////////////////////////

TEST_F(CodeGenPrepTest, DoubleArrParams)
{
    SetUpNoExecute("milestone_8/double_arr_params/main.cvc");
    ASSERT_EXIT(
        run_code_gen_preparation(input_filepath.c_str()), testing::ExitedWithCode(1),
        testing::AllOf(testing::HasSubstr("already defined"), testing::HasSubstr(" 3 Error")));
}

TEST_F(CodeGenPrepTest, EdgeCaseInvalid)
{
    SetUpNoExecute("preperation/edgecase/invalid.cvc");
    ASSERT_EXIT(run_code_gen_preparation(input_filepath.c_str()), testing::ExitedWithCode(1),
                testing::AllOf(testing::HasSubstr("'a' already defined at 1:19 - 1:28"),
                               testing::HasSubstr("'a' was not declared"),
                               testing::HasSubstr(" 2 Error")));
}
